import{h as Di,a as Li,w as Bi,ad as Pi,aJ as Vi,z as Ui,o as Dt,aK as $i,aF as gn,Q as yn}from"./9kG4W4Rk.js";import{_ as Hi}from"./BklV0quq.js";import{e as Ns,a as Gi,t as Xi}from"./CqA1Wqh6.js";import{i as Yi}from"./m6SQssH-.js";import{p as mn,b as qi}from"./CKqczBdQ.js";import{c as ws}from"./BxrjmSyr.js";function Np(s,t,e,n,r){var a;Di&&Li();var i=(a=t.$$slots)==null?void 0:a[e],o=!1;i===!0&&(i=t[e==="default"?"children":e],o=!0),i===void 0?r!==null&&r(s):i(s,o?()=>n:n)}function De(s,t){return s==null||t==null?NaN:s<t?-1:s>t?1:s>=t?0:NaN}function Zi(s,t){return s==null||t==null?NaN:t<s?-1:t>s?1:t>=s?0:NaN}function fr(s){let t,e,n;s.length!==2?(t=De,e=(a,h)=>De(s(a),h),n=(a,h)=>s(a)-h):(t=s===De||s===Zi?s:Wi,e=s,n=s);function r(a,h,u=0,c=a.length){if(u<c){if(t(h,h)!==0)return c;do{const l=u+c>>>1;e(a[l],h)<0?u=l+1:c=l}while(u<c)}return u}function i(a,h,u=0,c=a.length){if(u<c){if(t(h,h)!==0)return c;do{const l=u+c>>>1;e(a[l],h)<=0?u=l+1:c=l}while(u<c)}return u}function o(a,h,u=0,c=a.length){const l=r(a,h,u,c-1);return l>u&&n(a[l-1],h)>-n(a[l],h)?l-1:l}return{left:r,center:o,right:i}}function Wi(){return 0}function Ki(s){return s===null?NaN:+s}const Ji=fr(De),Qi=Ji.right;fr(Ki).center;const ji=Math.sqrt(50),to=Math.sqrt(10),eo=Math.sqrt(2);function Ue(s,t,e){const n=(t-s)/Math.max(0,e),r=Math.floor(Math.log10(n)),i=n/Math.pow(10,r),o=i>=ji?10:i>=to?5:i>=eo?2:1;let a,h,u;return r<0?(u=Math.pow(10,-r)/o,a=Math.round(s*u),h=Math.round(t*u),a/u<s&&++a,h/u>t&&--h,u=-u):(u=Math.pow(10,r)*o,a=Math.round(s/u),h=Math.round(t/u),a*u<s&&++a,h*u>t&&--h),h<a&&.5<=e&&e<2?Ue(s,t,e*2):[a,h,u]}function no(s,t,e){if(t=+t,s=+s,e=+e,!(e>0))return[];if(s===t)return[s];const n=t<s,[r,i,o]=n?Ue(t,s,e):Ue(s,t,e);if(!(i>=r))return[];const a=i-r+1,h=new Array(a);if(n)if(o<0)for(let u=0;u<a;++u)h[u]=(i-u)/-o;else for(let u=0;u<a;++u)h[u]=(i-u)*o;else if(o<0)for(let u=0;u<a;++u)h[u]=(r+u)/-o;else for(let u=0;u<a;++u)h[u]=(r+u)*o;return h}function zn(s,t,e){return t=+t,s=+s,e=+e,Ue(s,t,e)[2]}function so(s,t,e){t=+t,s=+s,e=+e;const n=t<s,r=n?zn(t,s,e):zn(s,t,e);return(n?-1:1)*(r<0?1/-r:r)}var ro={value:()=>{}};function dr(){for(var s=0,t=arguments.length,e={},n;s<t;++s){if(!(n=arguments[s]+"")||n in e||/[\s.]/.test(n))throw new Error("illegal type: "+n);e[n]=[]}return new Le(e)}function Le(s){this._=s}function io(s,t){return s.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}})}Le.prototype=dr.prototype={constructor:Le,on:function(s,t){var e=this._,n=io(s+"",e),r,i=-1,o=n.length;if(arguments.length<2){for(;++i<o;)if((r=(s=n[i]).type)&&(r=oo(e[r],s.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<o;)if(r=(s=n[i]).type)e[r]=Ts(e[r],s.name,t);else if(t==null)for(r in e)e[r]=Ts(e[r],s.name,null);return this},copy:function(){var s={},t=this._;for(var e in t)s[e]=t[e].slice();return new Le(s)},call:function(s,t){if((r=arguments.length-2)>0)for(var e=new Array(r),n=0,r,i;n<r;++n)e[n]=arguments[n+2];if(!this._.hasOwnProperty(s))throw new Error("unknown type: "+s);for(i=this._[s],n=0,r=i.length;n<r;++n)i[n].value.apply(t,e)},apply:function(s,t,e){if(!this._.hasOwnProperty(s))throw new Error("unknown type: "+s);for(var n=this._[s],r=0,i=n.length;r<i;++r)n[r].value.apply(t,e)}};function oo(s,t){for(var e=0,n=s.length,r;e<n;++e)if((r=s[e]).name===t)return r.value}function Ts(s,t,e){for(var n=0,r=s.length;n<r;++n)if(s[n].name===t){s[n]=ro,s=s.slice(0,n).concat(s.slice(n+1));break}return e!=null&&s.push({name:t,value:e}),s}var Fn="http://www.w3.org/1999/xhtml";const _s={svg:"http://www.w3.org/2000/svg",xhtml:Fn,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function sn(s){var t=s+="",e=t.indexOf(":");return e>=0&&(t=s.slice(0,e))!=="xmlns"&&(s=s.slice(e+1)),_s.hasOwnProperty(t)?{space:_s[t],local:s}:s}function ao(s){return function(){var t=this.ownerDocument,e=this.namespaceURI;return e===Fn&&t.documentElement.namespaceURI===Fn?t.createElement(s):t.createElementNS(e,s)}}function ho(s){return function(){return this.ownerDocument.createElementNS(s.space,s.local)}}function pr(s){var t=sn(s);return(t.local?ho:ao)(t)}function uo(){}function Gn(s){return s==null?uo:function(){return this.querySelector(s)}}function co(s){typeof s!="function"&&(s=Gn(s));for(var t=this._groups,e=t.length,n=new Array(e),r=0;r<e;++r)for(var i=t[r],o=i.length,a=n[r]=new Array(o),h,u,c=0;c<o;++c)(h=i[c])&&(u=s.call(h,h.__data__,c,i))&&("__data__"in h&&(u.__data__=h.__data__),a[c]=u);return new dt(n,this._parents)}function lo(s){return s==null?[]:Array.isArray(s)?s:Array.from(s)}function fo(){return[]}function gr(s){return s==null?fo:function(){return this.querySelectorAll(s)}}function po(s){return function(){return lo(s.apply(this,arguments))}}function go(s){typeof s=="function"?s=po(s):s=gr(s);for(var t=this._groups,e=t.length,n=[],r=[],i=0;i<e;++i)for(var o=t[i],a=o.length,h,u=0;u<a;++u)(h=o[u])&&(n.push(s.call(h,h.__data__,u,o)),r.push(h));return new dt(n,r)}function yr(s){return function(){return this.matches(s)}}function mr(s){return function(t){return t.matches(s)}}var yo=Array.prototype.find;function mo(s){return function(){return yo.call(this.children,s)}}function xo(){return this.firstElementChild}function No(s){return this.select(s==null?xo:mo(typeof s=="function"?s:mr(s)))}var wo=Array.prototype.filter;function To(){return Array.from(this.children)}function _o(s){return function(){return wo.call(this.children,s)}}function Mo(s){return this.selectAll(s==null?To:_o(typeof s=="function"?s:mr(s)))}function So(s){typeof s!="function"&&(s=yr(s));for(var t=this._groups,e=t.length,n=new Array(e),r=0;r<e;++r)for(var i=t[r],o=i.length,a=n[r]=[],h,u=0;u<o;++u)(h=i[u])&&s.call(h,h.__data__,u,i)&&a.push(h);return new dt(n,this._parents)}function xr(s){return new Array(s.length)}function Co(){return new dt(this._enter||this._groups.map(xr),this._parents)}function $e(s,t){this.ownerDocument=s.ownerDocument,this.namespaceURI=s.namespaceURI,this._next=null,this._parent=s,this.__data__=t}$e.prototype={constructor:$e,appendChild:function(s){return this._parent.insertBefore(s,this._next)},insertBefore:function(s,t){return this._parent.insertBefore(s,t)},querySelector:function(s){return this._parent.querySelector(s)},querySelectorAll:function(s){return this._parent.querySelectorAll(s)}};function Ao(s){return function(){return s}}function Eo(s,t,e,n,r,i){for(var o=0,a,h=t.length,u=i.length;o<u;++o)(a=t[o])?(a.__data__=i[o],n[o]=a):e[o]=new $e(s,i[o]);for(;o<h;++o)(a=t[o])&&(r[o]=a)}function vo(s,t,e,n,r,i,o){var a,h,u=new Map,c=t.length,l=i.length,f=new Array(c),d;for(a=0;a<c;++a)(h=t[a])&&(f[a]=d=o.call(h,h.__data__,a,t)+"",u.has(d)?r[a]=h:u.set(d,h));for(a=0;a<l;++a)d=o.call(s,i[a],a,i)+"",(h=u.get(d))?(n[a]=h,h.__data__=i[a],u.delete(d)):e[a]=new $e(s,i[a]);for(a=0;a<c;++a)(h=t[a])&&u.get(f[a])===h&&(r[a]=h)}function zo(s){return s.__data__}function Fo(s,t){if(!arguments.length)return Array.from(this,zo);var e=t?vo:Eo,n=this._parents,r=this._groups;typeof s!="function"&&(s=Ao(s));for(var i=r.length,o=new Array(i),a=new Array(i),h=new Array(i),u=0;u<i;++u){var c=n[u],l=r[u],f=l.length,d=Ro(s.call(c,c&&c.__data__,u,n)),g=d.length,x=a[u]=new Array(g),w=o[u]=new Array(g),_=h[u]=new Array(f);e(c,l,x,w,_,d,t);for(var v=0,E=0,F,C;v<g;++v)if(F=x[v]){for(v>=E&&(E=v+1);!(C=w[E])&&++E<g;);F._next=C||null}}return o=new dt(o,n),o._enter=a,o._exit=h,o}function Ro(s){return typeof s=="object"&&"length"in s?s:Array.from(s)}function bo(){return new dt(this._exit||this._groups.map(xr),this._parents)}function Io(s,t,e){var n=this.enter(),r=this,i=this.exit();return typeof s=="function"?(n=s(n),n&&(n=n.selection())):n=n.append(s+""),t!=null&&(r=t(r),r&&(r=r.selection())),e==null?i.remove():e(i),n&&r?n.merge(r).order():r}function Oo(s){for(var t=s.selection?s.selection():s,e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),h=0;h<o;++h)for(var u=e[h],c=n[h],l=u.length,f=a[h]=new Array(l),d,g=0;g<l;++g)(d=u[g]||c[g])&&(f[g]=d);for(;h<r;++h)a[h]=e[h];return new dt(a,this._parents)}function ko(){for(var s=this._groups,t=-1,e=s.length;++t<e;)for(var n=s[t],r=n.length-1,i=n[r],o;--r>=0;)(o=n[r])&&(i&&o.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(o,i),i=o);return this}function Do(s){s||(s=Lo);function t(l,f){return l&&f?s(l.__data__,f.__data__):!l-!f}for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i){for(var o=e[i],a=o.length,h=r[i]=new Array(a),u,c=0;c<a;++c)(u=o[c])&&(h[c]=u);h.sort(t)}return new dt(r,this._parents).order()}function Lo(s,t){return s<t?-1:s>t?1:s>=t?0:NaN}function Bo(){var s=arguments[0];return arguments[0]=this,s.apply(null,arguments),this}function Po(){return Array.from(this)}function Vo(){for(var s=this._groups,t=0,e=s.length;t<e;++t)for(var n=s[t],r=0,i=n.length;r<i;++r){var o=n[r];if(o)return o}return null}function Uo(){let s=0;for(const t of this)++s;return s}function $o(){return!this.node()}function Ho(s){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length,a;i<o;++i)(a=r[i])&&s.call(a,a.__data__,i,r);return this}function Go(s){return function(){this.removeAttribute(s)}}function Xo(s){return function(){this.removeAttributeNS(s.space,s.local)}}function Yo(s,t){return function(){this.setAttribute(s,t)}}function qo(s,t){return function(){this.setAttributeNS(s.space,s.local,t)}}function Zo(s,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttribute(s):this.setAttribute(s,e)}}function Wo(s,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttributeNS(s.space,s.local):this.setAttributeNS(s.space,s.local,e)}}function Ko(s,t){var e=sn(s);if(arguments.length<2){var n=this.node();return e.local?n.getAttributeNS(e.space,e.local):n.getAttribute(e)}return this.each((t==null?e.local?Xo:Go:typeof t=="function"?e.local?Wo:Zo:e.local?qo:Yo)(e,t))}function Nr(s){return s.ownerDocument&&s.ownerDocument.defaultView||s.document&&s||s.defaultView}function Jo(s){return function(){this.style.removeProperty(s)}}function Qo(s,t,e){return function(){this.style.setProperty(s,t,e)}}function jo(s,t,e){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(s):this.style.setProperty(s,n,e)}}function ta(s,t,e){return arguments.length>1?this.each((t==null?Jo:typeof t=="function"?jo:Qo)(s,t,e??"")):Kt(this.node(),s)}function Kt(s,t){return s.style.getPropertyValue(t)||Nr(s).getComputedStyle(s,null).getPropertyValue(t)}function ea(s){return function(){delete this[s]}}function na(s,t){return function(){this[s]=t}}function sa(s,t){return function(){var e=t.apply(this,arguments);e==null?delete this[s]:this[s]=e}}function ra(s,t){return arguments.length>1?this.each((t==null?ea:typeof t=="function"?sa:na)(s,t)):this.node()[s]}function wr(s){return s.trim().split(/^|\s+/)}function Xn(s){return s.classList||new Tr(s)}function Tr(s){this._node=s,this._names=wr(s.getAttribute("class")||"")}Tr.prototype={add:function(s){var t=this._names.indexOf(s);t<0&&(this._names.push(s),this._node.setAttribute("class",this._names.join(" ")))},remove:function(s){var t=this._names.indexOf(s);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(s){return this._names.indexOf(s)>=0}};function _r(s,t){for(var e=Xn(s),n=-1,r=t.length;++n<r;)e.add(t[n])}function Mr(s,t){for(var e=Xn(s),n=-1,r=t.length;++n<r;)e.remove(t[n])}function ia(s){return function(){_r(this,s)}}function oa(s){return function(){Mr(this,s)}}function aa(s,t){return function(){(t.apply(this,arguments)?_r:Mr)(this,s)}}function ha(s,t){var e=wr(s+"");if(arguments.length<2){for(var n=Xn(this.node()),r=-1,i=e.length;++r<i;)if(!n.contains(e[r]))return!1;return!0}return this.each((typeof t=="function"?aa:t?ia:oa)(e,t))}function ua(){this.textContent=""}function ca(s){return function(){this.textContent=s}}function la(s){return function(){var t=s.apply(this,arguments);this.textContent=t??""}}function fa(s){return arguments.length?this.each(s==null?ua:(typeof s=="function"?la:ca)(s)):this.node().textContent}function da(){this.innerHTML=""}function pa(s){return function(){this.innerHTML=s}}function ga(s){return function(){var t=s.apply(this,arguments);this.innerHTML=t??""}}function ya(s){return arguments.length?this.each(s==null?da:(typeof s=="function"?ga:pa)(s)):this.node().innerHTML}function ma(){this.nextSibling&&this.parentNode.appendChild(this)}function xa(){return this.each(ma)}function Na(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function wa(){return this.each(Na)}function Ta(s){var t=typeof s=="function"?s:pr(s);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function _a(){return null}function Ma(s,t){var e=typeof s=="function"?s:pr(s),n=t==null?_a:typeof t=="function"?t:Gn(t);return this.select(function(){return this.insertBefore(e.apply(this,arguments),n.apply(this,arguments)||null)})}function Sa(){var s=this.parentNode;s&&s.removeChild(this)}function Ca(){return this.each(Sa)}function Aa(){var s=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(s,this.nextSibling):s}function Ea(){var s=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(s,this.nextSibling):s}function va(s){return this.select(s?Ea:Aa)}function za(s){return arguments.length?this.property("__data__",s):this.node().__data__}function Fa(s){return function(t){s.call(this,t,this.__data__)}}function Ra(s){return s.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}function ba(s){return function(){var t=this.__on;if(t){for(var e=0,n=-1,r=t.length,i;e<r;++e)i=t[e],(!s.type||i.type===s.type)&&i.name===s.name?this.removeEventListener(i.type,i.listener,i.options):t[++n]=i;++n?t.length=n:delete this.__on}}}function Ia(s,t,e){return function(){var n=this.__on,r,i=Fa(t);if(n){for(var o=0,a=n.length;o<a;++o)if((r=n[o]).type===s.type&&r.name===s.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=e),r.value=t;return}}this.addEventListener(s.type,i,e),r={type:s.type,name:s.name,value:t,listener:i,options:e},n?n.push(r):this.__on=[r]}}function Oa(s,t,e){var n=Ra(s+""),r,i=n.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var h=0,u=a.length,c;h<u;++h)for(r=0,c=a[h];r<i;++r)if((o=n[r]).type===c.type&&o.name===c.name)return c.value}return}for(a=t?Ia:ba,r=0;r<i;++r)this.each(a(n[r],t,e));return this}function Sr(s,t,e){var n=Nr(s),r=n.CustomEvent;typeof r=="function"?r=new r(t,e):(r=n.document.createEvent("Event"),e?(r.initEvent(t,e.bubbles,e.cancelable),r.detail=e.detail):r.initEvent(t,!1,!1)),s.dispatchEvent(r)}function ka(s,t){return function(){return Sr(this,s,t)}}function Da(s,t){return function(){return Sr(this,s,t.apply(this,arguments))}}function La(s,t){return this.each((typeof t=="function"?Da:ka)(s,t))}function*Ba(){for(var s=this._groups,t=0,e=s.length;t<e;++t)for(var n=s[t],r=0,i=n.length,o;r<i;++r)(o=n[r])&&(yield o)}var Pa=[null];function dt(s,t){this._groups=s,this._parents=t}function me(){return new dt([[document.documentElement]],Pa)}function Va(){return this}dt.prototype=me.prototype={constructor:dt,select:co,selectAll:go,selectChild:No,selectChildren:Mo,filter:So,data:Fo,enter:Co,exit:bo,join:Io,merge:Oo,selection:Va,order:ko,sort:Do,call:Bo,nodes:Po,node:Vo,size:Uo,empty:$o,each:Ho,attr:Ko,style:ta,property:ra,classed:ha,text:fa,html:ya,raise:xa,lower:wa,append:Ta,insert:Ma,remove:Ca,clone:va,datum:za,on:Oa,dispatch:La,[Symbol.iterator]:Ba};function Yn(s,t,e){s.prototype=t.prototype=e,e.constructor=s}function Cr(s,t){var e=Object.create(s.prototype);for(var n in t)e[n]=t[n];return e}function xe(){}var pe=.7,He=1/pe,qt="\\s*([+-]?\\d+)\\s*",ge="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",gt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ua=/^#([0-9a-f]{3,8})$/,$a=new RegExp(`^rgb\\(${qt},${qt},${qt}\\)$`),Ha=new RegExp(`^rgb\\(${gt},${gt},${gt}\\)$`),Ga=new RegExp(`^rgba\\(${qt},${qt},${qt},${ge}\\)$`),Xa=new RegExp(`^rgba\\(${gt},${gt},${gt},${ge}\\)$`),Ya=new RegExp(`^hsl\\(${ge},${gt},${gt}\\)$`),qa=new RegExp(`^hsla\\(${ge},${gt},${gt},${ge}\\)$`),Ms={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Yn(xe,Vt,{copy(s){return Object.assign(new this.constructor,this,s)},displayable(){return this.rgb().displayable()},hex:Ss,formatHex:Ss,formatHex8:Za,formatHsl:Wa,formatRgb:Cs,toString:Cs});function Ss(){return this.rgb().formatHex()}function Za(){return this.rgb().formatHex8()}function Wa(){return Ar(this).formatHsl()}function Cs(){return this.rgb().formatRgb()}function Vt(s){var t,e;return s=(s+"").trim().toLowerCase(),(t=Ua.exec(s))?(e=t[1].length,t=parseInt(t[1],16),e===6?As(t):e===3?new tt(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?ve(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?ve(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=$a.exec(s))?new tt(t[1],t[2],t[3],1):(t=Ha.exec(s))?new tt(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Ga.exec(s))?ve(t[1],t[2],t[3],t[4]):(t=Xa.exec(s))?ve(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Ya.exec(s))?zs(t[1],t[2]/100,t[3]/100,1):(t=qa.exec(s))?zs(t[1],t[2]/100,t[3]/100,t[4]):Ms.hasOwnProperty(s)?As(Ms[s]):s==="transparent"?new tt(NaN,NaN,NaN,0):null}function As(s){return new tt(s>>16&255,s>>8&255,s&255,1)}function ve(s,t,e,n){return n<=0&&(s=t=e=NaN),new tt(s,t,e,n)}function Ka(s){return s instanceof xe||(s=Vt(s)),s?(s=s.rgb(),new tt(s.r,s.g,s.b,s.opacity)):new tt}function Rn(s,t,e,n){return arguments.length===1?Ka(s):new tt(s,t,e,n??1)}function tt(s,t,e,n){this.r=+s,this.g=+t,this.b=+e,this.opacity=+n}Yn(tt,Rn,Cr(xe,{brighter(s){return s=s==null?He:Math.pow(He,s),new tt(this.r*s,this.g*s,this.b*s,this.opacity)},darker(s){return s=s==null?pe:Math.pow(pe,s),new tt(this.r*s,this.g*s,this.b*s,this.opacity)},rgb(){return this},clamp(){return new tt(Pt(this.r),Pt(this.g),Pt(this.b),Ge(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Es,formatHex:Es,formatHex8:Ja,formatRgb:vs,toString:vs}));function Es(){return`#${Lt(this.r)}${Lt(this.g)}${Lt(this.b)}`}function Ja(){return`#${Lt(this.r)}${Lt(this.g)}${Lt(this.b)}${Lt((isNaN(this.opacity)?1:this.opacity)*255)}`}function vs(){const s=Ge(this.opacity);return`${s===1?"rgb(":"rgba("}${Pt(this.r)}, ${Pt(this.g)}, ${Pt(this.b)}${s===1?")":`, ${s})`}`}function Ge(s){return isNaN(s)?1:Math.max(0,Math.min(1,s))}function Pt(s){return Math.max(0,Math.min(255,Math.round(s)||0))}function Lt(s){return s=Pt(s),(s<16?"0":"")+s.toString(16)}function zs(s,t,e,n){return n<=0?s=t=e=NaN:e<=0||e>=1?s=t=NaN:t<=0&&(s=NaN),new lt(s,t,e,n)}function Ar(s){if(s instanceof lt)return new lt(s.h,s.s,s.l,s.opacity);if(s instanceof xe||(s=Vt(s)),!s)return new lt;if(s instanceof lt)return s;s=s.rgb();var t=s.r/255,e=s.g/255,n=s.b/255,r=Math.min(t,e,n),i=Math.max(t,e,n),o=NaN,a=i-r,h=(i+r)/2;return a?(t===i?o=(e-n)/a+(e<n)*6:e===i?o=(n-t)/a+2:o=(t-e)/a+4,a/=h<.5?i+r:2-i-r,o*=60):a=h>0&&h<1?0:o,new lt(o,a,h,s.opacity)}function Qa(s,t,e,n){return arguments.length===1?Ar(s):new lt(s,t,e,n??1)}function lt(s,t,e,n){this.h=+s,this.s=+t,this.l=+e,this.opacity=+n}Yn(lt,Qa,Cr(xe,{brighter(s){return s=s==null?He:Math.pow(He,s),new lt(this.h,this.s,this.l*s,this.opacity)},darker(s){return s=s==null?pe:Math.pow(pe,s),new lt(this.h,this.s,this.l*s,this.opacity)},rgb(){var s=this.h%360+(this.h<0)*360,t=isNaN(s)||isNaN(this.s)?0:this.s,e=this.l,n=e+(e<.5?e:1-e)*t,r=2*e-n;return new tt(xn(s>=240?s-240:s+120,r,n),xn(s,r,n),xn(s<120?s+240:s-120,r,n),this.opacity)},clamp(){return new lt(Fs(this.h),ze(this.s),ze(this.l),Ge(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const s=Ge(this.opacity);return`${s===1?"hsl(":"hsla("}${Fs(this.h)}, ${ze(this.s)*100}%, ${ze(this.l)*100}%${s===1?")":`, ${s})`}`}}));function Fs(s){return s=(s||0)%360,s<0?s+360:s}function ze(s){return Math.max(0,Math.min(1,s||0))}function xn(s,t,e){return(s<60?t+(e-t)*s/60:s<180?e:s<240?t+(e-t)*(240-s)/60:t)*255}const qn=s=>()=>s;function ja(s,t){return function(e){return s+e*t}}function th(s,t,e){return s=Math.pow(s,e),t=Math.pow(t,e)-s,e=1/e,function(n){return Math.pow(s+n*t,e)}}function eh(s){return(s=+s)==1?Er:function(t,e){return e-t?th(t,e,s):qn(isNaN(t)?e:t)}}function Er(s,t){var e=t-s;return e?ja(s,e):qn(isNaN(s)?t:s)}const Xe=function s(t){var e=eh(t);function n(r,i){var o=e((r=Rn(r)).r,(i=Rn(i)).r),a=e(r.g,i.g),h=e(r.b,i.b),u=Er(r.opacity,i.opacity);return function(c){return r.r=o(c),r.g=a(c),r.b=h(c),r.opacity=u(c),r+""}}return n.gamma=s,n}(1);function nh(s,t){t||(t=[]);var e=s?Math.min(t.length,s.length):0,n=t.slice(),r;return function(i){for(r=0;r<e;++r)n[r]=s[r]*(1-i)+t[r]*i;return n}}function sh(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function rh(s,t){var e=t?t.length:0,n=s?Math.min(e,s.length):0,r=new Array(n),i=new Array(e),o;for(o=0;o<n;++o)r[o]=Zn(s[o],t[o]);for(;o<e;++o)i[o]=t[o];return function(a){for(o=0;o<n;++o)i[o]=r[o](a);return i}}function ih(s,t){var e=new Date;return s=+s,t=+t,function(n){return e.setTime(s*(1-n)+t*n),e}}function ct(s,t){return s=+s,t=+t,function(e){return s*(1-e)+t*e}}function oh(s,t){var e={},n={},r;(s===null||typeof s!="object")&&(s={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in s?e[r]=Zn(s[r],t[r]):n[r]=t[r];return function(i){for(r in e)n[r]=e[r](i);return n}}var bn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Nn=new RegExp(bn.source,"g");function ah(s){return function(){return s}}function hh(s){return function(t){return s(t)+""}}function vr(s,t){var e=bn.lastIndex=Nn.lastIndex=0,n,r,i,o=-1,a=[],h=[];for(s=s+"",t=t+"";(n=bn.exec(s))&&(r=Nn.exec(t));)(i=r.index)>e&&(i=t.slice(e,i),a[o]?a[o]+=i:a[++o]=i),(n=n[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,h.push({i:o,x:ct(n,r)})),e=Nn.lastIndex;return e<t.length&&(i=t.slice(e),a[o]?a[o]+=i:a[++o]=i),a.length<2?h[0]?hh(h[0].x):ah(t):(t=h.length,function(u){for(var c=0,l;c<t;++c)a[(l=h[c]).i]=l.x(u);return a.join("")})}function Zn(s,t){var e=typeof t,n;return t==null||e==="boolean"?qn(t):(e==="number"?ct:e==="string"?(n=Vt(t))?(t=n,Xe):vr:t instanceof Vt?Xe:t instanceof Date?ih:sh(t)?nh:Array.isArray(t)?rh:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?oh:ct)(s,t)}function uh(s,t){return s=+s,t=+t,function(e){return Math.round(s*(1-e)+t*e)}}var Rs=180/Math.PI,In={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function zr(s,t,e,n,r,i){var o,a,h;return(o=Math.sqrt(s*s+t*t))&&(s/=o,t/=o),(h=s*e+t*n)&&(e-=s*h,n-=t*h),(a=Math.sqrt(e*e+n*n))&&(e/=a,n/=a,h/=a),s*n<t*e&&(s=-s,t=-t,h=-h,o=-o),{translateX:r,translateY:i,rotate:Math.atan2(t,s)*Rs,skewX:Math.atan(h)*Rs,scaleX:o,scaleY:a}}var Fe;function ch(s){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(s+"");return t.isIdentity?In:zr(t.a,t.b,t.c,t.d,t.e,t.f)}function lh(s){return s==null||(Fe||(Fe=document.createElementNS("http://www.w3.org/2000/svg","g")),Fe.setAttribute("transform",s),!(s=Fe.transform.baseVal.consolidate()))?In:(s=s.matrix,zr(s.a,s.b,s.c,s.d,s.e,s.f))}function Fr(s,t,e,n){function r(u){return u.length?u.pop()+" ":""}function i(u,c,l,f,d,g){if(u!==l||c!==f){var x=d.push("translate(",null,t,null,e);g.push({i:x-4,x:ct(u,l)},{i:x-2,x:ct(c,f)})}else(l||f)&&d.push("translate("+l+t+f+e)}function o(u,c,l,f){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),f.push({i:l.push(r(l)+"rotate(",null,n)-2,x:ct(u,c)})):c&&l.push(r(l)+"rotate("+c+n)}function a(u,c,l,f){u!==c?f.push({i:l.push(r(l)+"skewX(",null,n)-2,x:ct(u,c)}):c&&l.push(r(l)+"skewX("+c+n)}function h(u,c,l,f,d,g){if(u!==l||c!==f){var x=d.push(r(d)+"scale(",null,",",null,")");g.push({i:x-4,x:ct(u,l)},{i:x-2,x:ct(c,f)})}else(l!==1||f!==1)&&d.push(r(d)+"scale("+l+","+f+")")}return function(u,c){var l=[],f=[];return u=s(u),c=s(c),i(u.translateX,u.translateY,c.translateX,c.translateY,l,f),o(u.rotate,c.rotate,l,f),a(u.skewX,c.skewX,l,f),h(u.scaleX,u.scaleY,c.scaleX,c.scaleY,l,f),u=c=null,function(d){for(var g=-1,x=f.length,w;++g<x;)l[(w=f[g]).i]=w.x(d);return l.join("")}}}var fh=Fr(ch,"px, ","px)","deg)"),dh=Fr(lh,", ",")",")"),Jt=0,he=0,te=0,Rr=1e3,Ye,ue,qe=0,Ut=0,rn=0,ye=typeof performance=="object"&&performance.now?performance:Date,br=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(s){setTimeout(s,17)};function Wn(){return Ut||(br(ph),Ut=ye.now()+rn)}function ph(){Ut=0}function Ze(){this._call=this._time=this._next=null}Ze.prototype=Ir.prototype={constructor:Ze,restart:function(s,t,e){if(typeof s!="function")throw new TypeError("callback is not a function");e=(e==null?Wn():+e)+(t==null?0:+t),!this._next&&ue!==this&&(ue?ue._next=this:Ye=this,ue=this),this._call=s,this._time=e,On()},stop:function(){this._call&&(this._call=null,this._time=1/0,On())}};function Ir(s,t,e){var n=new Ze;return n.restart(s,t,e),n}function gh(){Wn(),++Jt;for(var s=Ye,t;s;)(t=Ut-s._time)>=0&&s._call.call(void 0,t),s=s._next;--Jt}function bs(){Ut=(qe=ye.now())+rn,Jt=he=0;try{gh()}finally{Jt=0,mh(),Ut=0}}function yh(){var s=ye.now(),t=s-qe;t>Rr&&(rn-=t,qe=s)}function mh(){for(var s,t=Ye,e,n=1/0;t;)t._call?(n>t._time&&(n=t._time),s=t,t=t._next):(e=t._next,t._next=null,t=s?s._next=e:Ye=e);ue=s,On(n)}function On(s){if(!Jt){he&&(he=clearTimeout(he));var t=s-Ut;t>24?(s<1/0&&(he=setTimeout(bs,s-ye.now()-rn)),te&&(te=clearInterval(te))):(te||(qe=ye.now(),te=setInterval(yh,Rr)),Jt=1,br(bs))}}function Is(s,t,e){var n=new Ze;return t=t==null?0:+t,n.restart(r=>{n.stop(),s(r+t)},t,e),n}var xh=dr("start","end","cancel","interrupt"),Nh=[],Or=0,Os=1,kn=2,Be=3,ks=4,Dn=5,Pe=6;function on(s,t,e,n,r,i){var o=s.__transition;if(!o)s.__transition={};else if(e in o)return;wh(s,e,{name:t,index:n,group:r,on:xh,tween:Nh,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Or})}function Kn(s,t){var e=pt(s,t);if(e.state>Or)throw new Error("too late; already scheduled");return e}function Nt(s,t){var e=pt(s,t);if(e.state>Be)throw new Error("too late; already running");return e}function pt(s,t){var e=s.__transition;if(!e||!(e=e[t]))throw new Error("transition not found");return e}function wh(s,t,e){var n=s.__transition,r;n[t]=e,e.timer=Ir(i,0,e.time);function i(u){e.state=Os,e.timer.restart(o,e.delay,e.time),e.delay<=u&&o(u-e.delay)}function o(u){var c,l,f,d;if(e.state!==Os)return h();for(c in n)if(d=n[c],d.name===e.name){if(d.state===Be)return Is(o);d.state===ks?(d.state=Pe,d.timer.stop(),d.on.call("interrupt",s,s.__data__,d.index,d.group),delete n[c]):+c<t&&(d.state=Pe,d.timer.stop(),d.on.call("cancel",s,s.__data__,d.index,d.group),delete n[c])}if(Is(function(){e.state===Be&&(e.state=ks,e.timer.restart(a,e.delay,e.time),a(u))}),e.state=kn,e.on.call("start",s,s.__data__,e.index,e.group),e.state===kn){for(e.state=Be,r=new Array(f=e.tween.length),c=0,l=-1;c<f;++c)(d=e.tween[c].value.call(s,s.__data__,e.index,e.group))&&(r[++l]=d);r.length=l+1}}function a(u){for(var c=u<e.duration?e.ease.call(null,u/e.duration):(e.timer.restart(h),e.state=Dn,1),l=-1,f=r.length;++l<f;)r[l].call(s,c);e.state===Dn&&(e.on.call("end",s,s.__data__,e.index,e.group),h())}function h(){e.state=Pe,e.timer.stop(),delete n[t];for(var u in n)return;delete s.__transition}}function Th(s,t){var e=s.__transition,n,r,i=!0,o;if(e){t=t==null?null:t+"";for(o in e){if((n=e[o]).name!==t){i=!1;continue}r=n.state>kn&&n.state<Dn,n.state=Pe,n.timer.stop(),n.on.call(r?"interrupt":"cancel",s,s.__data__,n.index,n.group),delete e[o]}i&&delete s.__transition}}function _h(s){return this.each(function(){Th(this,s)})}function Mh(s,t){var e,n;return function(){var r=Nt(this,s),i=r.tween;if(i!==e){n=e=i;for(var o=0,a=n.length;o<a;++o)if(n[o].name===t){n=n.slice(),n.splice(o,1);break}}r.tween=n}}function Sh(s,t,e){var n,r;if(typeof e!="function")throw new Error;return function(){var i=Nt(this,s),o=i.tween;if(o!==n){r=(n=o).slice();for(var a={name:t,value:e},h=0,u=r.length;h<u;++h)if(r[h].name===t){r[h]=a;break}h===u&&r.push(a)}i.tween=r}}function Ch(s,t){var e=this._id;if(s+="",arguments.length<2){for(var n=pt(this.node(),e).tween,r=0,i=n.length,o;r<i;++r)if((o=n[r]).name===s)return o.value;return null}return this.each((t==null?Mh:Sh)(e,s,t))}function Jn(s,t,e){var n=s._id;return s.each(function(){var r=Nt(this,n);(r.value||(r.value={}))[t]=e.apply(this,arguments)}),function(r){return pt(r,n).value[t]}}function kr(s,t){var e;return(typeof t=="number"?ct:t instanceof Vt?Xe:(e=Vt(t))?(t=e,Xe):vr)(s,t)}function Ah(s){return function(){this.removeAttribute(s)}}function Eh(s){return function(){this.removeAttributeNS(s.space,s.local)}}function vh(s,t,e){var n,r=e+"",i;return function(){var o=this.getAttribute(s);return o===r?null:o===n?i:i=t(n=o,e)}}function zh(s,t,e){var n,r=e+"",i;return function(){var o=this.getAttributeNS(s.space,s.local);return o===r?null:o===n?i:i=t(n=o,e)}}function Fh(s,t,e){var n,r,i;return function(){var o,a=e(this),h;return a==null?void this.removeAttribute(s):(o=this.getAttribute(s),h=a+"",o===h?null:o===n&&h===r?i:(r=h,i=t(n=o,a)))}}function Rh(s,t,e){var n,r,i;return function(){var o,a=e(this),h;return a==null?void this.removeAttributeNS(s.space,s.local):(o=this.getAttributeNS(s.space,s.local),h=a+"",o===h?null:o===n&&h===r?i:(r=h,i=t(n=o,a)))}}function bh(s,t){var e=sn(s),n=e==="transform"?dh:kr;return this.attrTween(s,typeof t=="function"?(e.local?Rh:Fh)(e,n,Jn(this,"attr."+s,t)):t==null?(e.local?Eh:Ah)(e):(e.local?zh:vh)(e,n,t))}function Ih(s,t){return function(e){this.setAttribute(s,t.call(this,e))}}function Oh(s,t){return function(e){this.setAttributeNS(s.space,s.local,t.call(this,e))}}function kh(s,t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&Oh(s,i)),e}return r._value=t,r}function Dh(s,t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&Ih(s,i)),e}return r._value=t,r}function Lh(s,t){var e="attr."+s;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;var n=sn(s);return this.tween(e,(n.local?kh:Dh)(n,t))}function Bh(s,t){return function(){Kn(this,s).delay=+t.apply(this,arguments)}}function Ph(s,t){return t=+t,function(){Kn(this,s).delay=t}}function Vh(s){var t=this._id;return arguments.length?this.each((typeof s=="function"?Bh:Ph)(t,s)):pt(this.node(),t).delay}function Uh(s,t){return function(){Nt(this,s).duration=+t.apply(this,arguments)}}function $h(s,t){return t=+t,function(){Nt(this,s).duration=t}}function Hh(s){var t=this._id;return arguments.length?this.each((typeof s=="function"?Uh:$h)(t,s)):pt(this.node(),t).duration}function Gh(s,t){if(typeof t!="function")throw new Error;return function(){Nt(this,s).ease=t}}function Xh(s){var t=this._id;return arguments.length?this.each(Gh(t,s)):pt(this.node(),t).ease}function Yh(s,t){return function(){var e=t.apply(this,arguments);if(typeof e!="function")throw new Error;Nt(this,s).ease=e}}function qh(s){if(typeof s!="function")throw new Error;return this.each(Yh(this._id,s))}function Zh(s){typeof s!="function"&&(s=yr(s));for(var t=this._groups,e=t.length,n=new Array(e),r=0;r<e;++r)for(var i=t[r],o=i.length,a=n[r]=[],h,u=0;u<o;++u)(h=i[u])&&s.call(h,h.__data__,u,i)&&a.push(h);return new zt(n,this._parents,this._name,this._id)}function Wh(s){if(s._id!==this._id)throw new Error;for(var t=this._groups,e=s._groups,n=t.length,r=e.length,i=Math.min(n,r),o=new Array(n),a=0;a<i;++a)for(var h=t[a],u=e[a],c=h.length,l=o[a]=new Array(c),f,d=0;d<c;++d)(f=h[d]||u[d])&&(l[d]=f);for(;a<n;++a)o[a]=t[a];return new zt(o,this._parents,this._name,this._id)}function Kh(s){return(s+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||t==="start"})}function Jh(s,t,e){var n,r,i=Kh(t)?Kn:Nt;return function(){var o=i(this,s),a=o.on;a!==n&&(r=(n=a).copy()).on(t,e),o.on=r}}function Qh(s,t){var e=this._id;return arguments.length<2?pt(this.node(),e).on.on(s):this.each(Jh(e,s,t))}function jh(s){return function(){var t=this.parentNode;for(var e in this.__transition)if(+e!==s)return;t&&t.removeChild(this)}}function tu(){return this.on("end.remove",jh(this._id))}function eu(s){var t=this._name,e=this._id;typeof s!="function"&&(s=Gn(s));for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o)for(var a=n[o],h=a.length,u=i[o]=new Array(h),c,l,f=0;f<h;++f)(c=a[f])&&(l=s.call(c,c.__data__,f,a))&&("__data__"in c&&(l.__data__=c.__data__),u[f]=l,on(u[f],t,e,f,u,pt(c,e)));return new zt(i,this._parents,t,e)}function nu(s){var t=this._name,e=this._id;typeof s!="function"&&(s=gr(s));for(var n=this._groups,r=n.length,i=[],o=[],a=0;a<r;++a)for(var h=n[a],u=h.length,c,l=0;l<u;++l)if(c=h[l]){for(var f=s.call(c,c.__data__,l,h),d,g=pt(c,e),x=0,w=f.length;x<w;++x)(d=f[x])&&on(d,t,e,x,f,g);i.push(f),o.push(c)}return new zt(i,o,t,e)}var su=me.prototype.constructor;function ru(){return new su(this._groups,this._parents)}function iu(s,t){var e,n,r;return function(){var i=Kt(this,s),o=(this.style.removeProperty(s),Kt(this,s));return i===o?null:i===e&&o===n?r:r=t(e=i,n=o)}}function Dr(s){return function(){this.style.removeProperty(s)}}function ou(s,t,e){var n,r=e+"",i;return function(){var o=Kt(this,s);return o===r?null:o===n?i:i=t(n=o,e)}}function au(s,t,e){var n,r,i;return function(){var o=Kt(this,s),a=e(this),h=a+"";return a==null&&(h=a=(this.style.removeProperty(s),Kt(this,s))),o===h?null:o===n&&h===r?i:(r=h,i=t(n=o,a))}}function hu(s,t){var e,n,r,i="style."+t,o="end."+i,a;return function(){var h=Nt(this,s),u=h.on,c=h.value[i]==null?a||(a=Dr(t)):void 0;(u!==e||r!==c)&&(n=(e=u).copy()).on(o,r=c),h.on=n}}function uu(s,t,e){var n=(s+="")=="transform"?fh:kr;return t==null?this.styleTween(s,iu(s,n)).on("end.style."+s,Dr(s)):typeof t=="function"?this.styleTween(s,au(s,n,Jn(this,"style."+s,t))).each(hu(this._id,s)):this.styleTween(s,ou(s,n,t),e).on("end.style."+s,null)}function cu(s,t,e){return function(n){this.style.setProperty(s,t.call(this,n),e)}}function lu(s,t,e){var n,r;function i(){var o=t.apply(this,arguments);return o!==r&&(n=(r=o)&&cu(s,o,e)),n}return i._value=t,i}function fu(s,t,e){var n="style."+(s+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,lu(s,t,e??""))}function du(s){return function(){this.textContent=s}}function pu(s){return function(){var t=s(this);this.textContent=t??""}}function gu(s){return this.tween("text",typeof s=="function"?pu(Jn(this,"text",s)):du(s==null?"":s+""))}function yu(s){return function(t){this.textContent=s.call(this,t)}}function mu(s){var t,e;function n(){var r=s.apply(this,arguments);return r!==e&&(t=(e=r)&&yu(r)),t}return n._value=s,n}function xu(s){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(s==null)return this.tween(t,null);if(typeof s!="function")throw new Error;return this.tween(t,mu(s))}function Nu(){for(var s=this._name,t=this._id,e=Lr(),n=this._groups,r=n.length,i=0;i<r;++i)for(var o=n[i],a=o.length,h,u=0;u<a;++u)if(h=o[u]){var c=pt(h,t);on(h,s,e,u,o,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new zt(n,this._parents,s,e)}function wu(){var s,t,e=this,n=e._id,r=e.size();return new Promise(function(i,o){var a={value:o},h={value:function(){--r===0&&i()}};e.each(function(){var u=Nt(this,n),c=u.on;c!==s&&(t=(s=c).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(h)),u.on=t}),r===0&&i()})}var Tu=0;function zt(s,t,e,n){this._groups=s,this._parents=t,this._name=e,this._id=n}function Lr(){return++Tu}var Ct=me.prototype;zt.prototype={constructor:zt,select:eu,selectAll:nu,selectChild:Ct.selectChild,selectChildren:Ct.selectChildren,filter:Zh,merge:Wh,selection:ru,transition:Nu,call:Ct.call,nodes:Ct.nodes,node:Ct.node,size:Ct.size,empty:Ct.empty,each:Ct.each,on:Qh,attr:bh,attrTween:Lh,style:uu,styleTween:fu,text:gu,textTween:xu,remove:tu,tween:Ch,delay:Vh,duration:Hh,ease:Xh,easeVarying:qh,end:wu,[Symbol.iterator]:Ct[Symbol.iterator]};function _u(s){return((s*=2)<=1?s*s*s:(s-=2)*s*s+2)/2}var Mu={time:null,delay:0,duration:250,ease:_u};function Su(s,t){for(var e;!(e=s.__transition)||!(e=e[t]);)if(!(s=s.parentNode))throw new Error(`transition ${t} not found`);return e}function Cu(s){var t,e;s instanceof zt?(t=s._id,s=s._name):(t=Lr(),(e=Mu).time=Wn(),s=s==null?null:s+"");for(var n=this._groups,r=n.length,i=0;i<r;++i)for(var o=n[i],a=o.length,h,u=0;u<a;++u)(h=o[u])&&on(h,s,t,u,o,e||Su(h,t));return new zt(n,this._parents,s,t)}me.prototype.interrupt=_h;me.prototype.transition=Cu;function Au(s){return Math.abs(s=Math.round(s))>=1e21?s.toLocaleString("en").replace(/,/g,""):s.toString(10)}function We(s,t){if((e=(s=t?s.toExponential(t-1):s.toExponential()).indexOf("e"))<0)return null;var e,n=s.slice(0,e);return[n.length>1?n[0]+n.slice(2):n,+s.slice(e+1)]}function Qt(s){return s=We(Math.abs(s)),s?s[1]:NaN}function Eu(s,t){return function(e,n){for(var r=e.length,i=[],o=0,a=s[0],h=0;r>0&&a>0&&(h+a+1>n&&(a=Math.max(1,n-h)),i.push(e.substring(r-=a,r+a)),!((h+=a+1)>n));)a=s[o=(o+1)%s.length];return i.reverse().join(t)}}function vu(s){return function(t){return t.replace(/[0-9]/g,function(e){return s[+e]})}}var zu=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ke(s){if(!(t=zu.exec(s)))throw new Error("invalid format: "+s);var t;return new Qn({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Ke.prototype=Qn.prototype;function Qn(s){this.fill=s.fill===void 0?" ":s.fill+"",this.align=s.align===void 0?">":s.align+"",this.sign=s.sign===void 0?"-":s.sign+"",this.symbol=s.symbol===void 0?"":s.symbol+"",this.zero=!!s.zero,this.width=s.width===void 0?void 0:+s.width,this.comma=!!s.comma,this.precision=s.precision===void 0?void 0:+s.precision,this.trim=!!s.trim,this.type=s.type===void 0?"":s.type+""}Qn.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Fu(s){t:for(var t=s.length,e=1,n=-1,r;e<t;++e)switch(s[e]){case".":n=r=e;break;case"0":n===0&&(n=e),r=e;break;default:if(!+s[e])break t;n>0&&(n=0);break}return n>0?s.slice(0,n)+s.slice(r+1):s}var Br;function Ru(s,t){var e=We(s,t);if(!e)return s+"";var n=e[0],r=e[1],i=r-(Br=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=n.length;return i===o?n:i>o?n+new Array(i-o+1).join("0"):i>0?n.slice(0,i)+"."+n.slice(i):"0."+new Array(1-i).join("0")+We(s,Math.max(0,t+i-1))[0]}function Ds(s,t){var e=We(s,t);if(!e)return s+"";var n=e[0],r=e[1];return r<0?"0."+new Array(-r).join("0")+n:n.length>r+1?n.slice(0,r+1)+"."+n.slice(r+1):n+new Array(r-n.length+2).join("0")}const Ls={"%":(s,t)=>(s*100).toFixed(t),b:s=>Math.round(s).toString(2),c:s=>s+"",d:Au,e:(s,t)=>s.toExponential(t),f:(s,t)=>s.toFixed(t),g:(s,t)=>s.toPrecision(t),o:s=>Math.round(s).toString(8),p:(s,t)=>Ds(s*100,t),r:Ds,s:Ru,X:s=>Math.round(s).toString(16).toUpperCase(),x:s=>Math.round(s).toString(16)};function Bs(s){return s}var Ps=Array.prototype.map,Vs=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function bu(s){var t=s.grouping===void 0||s.thousands===void 0?Bs:Eu(Ps.call(s.grouping,Number),s.thousands+""),e=s.currency===void 0?"":s.currency[0]+"",n=s.currency===void 0?"":s.currency[1]+"",r=s.decimal===void 0?".":s.decimal+"",i=s.numerals===void 0?Bs:vu(Ps.call(s.numerals,String)),o=s.percent===void 0?"%":s.percent+"",a=s.minus===void 0?"−":s.minus+"",h=s.nan===void 0?"NaN":s.nan+"";function u(l){l=Ke(l);var f=l.fill,d=l.align,g=l.sign,x=l.symbol,w=l.zero,_=l.width,v=l.comma,E=l.precision,F=l.trim,C=l.type;C==="n"?(v=!0,C="g"):Ls[C]||(E===void 0&&(E=12),F=!0,C="g"),(w||f==="0"&&d==="=")&&(w=!0,f="0",d="=");var k=x==="$"?e:x==="#"&&/[boxX]/.test(C)?"0"+C.toLowerCase():"",M=x==="$"?n:/[%p]/.test(C)?o:"",X=Ls[C],J=/[defgprs%]/.test(C);E=E===void 0?6:/[gprs]/.test(C)?Math.max(1,Math.min(21,E)):Math.max(0,Math.min(20,E));function Y(A){var Q=k,q=M,at,kt,_t;if(C==="c")q=X(A)+q,A="";else{A=+A;var Mt=A<0||1/A<0;if(A=isNaN(A)?h:X(Math.abs(A),E),F&&(A=Fu(A)),Mt&&+A==0&&g!=="+"&&(Mt=!1),Q=(Mt?g==="("?g:a:g==="-"||g==="("?"":g)+Q,q=(C==="s"?Vs[8+Br/3]:"")+q+(Mt&&g==="("?")":""),J){for(at=-1,kt=A.length;++at<kt;)if(_t=A.charCodeAt(at),48>_t||_t>57){q=(_t===46?r+A.slice(at+1):A.slice(at))+q,A=A.slice(0,at);break}}}v&&!w&&(A=t(A,1/0));var St=Q.length+A.length+q.length,j=St<_?new Array(_-St+1).join(f):"";switch(v&&w&&(A=t(j+A,j.length?_-q.length:1/0),j=""),d){case"<":A=Q+A+q+j;break;case"=":A=Q+j+A+q;break;case"^":A=j.slice(0,St=j.length>>1)+Q+A+q+j.slice(St);break;default:A=j+Q+A+q;break}return i(A)}return Y.toString=function(){return l+""},Y}function c(l,f){var d=u((l=Ke(l),l.type="f",l)),g=Math.max(-8,Math.min(8,Math.floor(Qt(f)/3)))*3,x=Math.pow(10,-g),w=Vs[8+g/3];return function(_){return d(x*_)+w}}return{format:u,formatPrefix:c}}var Re,Pr,Vr;Iu({thousands:",",grouping:[3],currency:["$",""]});function Iu(s){return Re=bu(s),Pr=Re.format,Vr=Re.formatPrefix,Re}function Ou(s){return Math.max(0,-Qt(Math.abs(s)))}function ku(s,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Qt(t)/3)))*3-Qt(Math.abs(s)))}function Du(s,t){return s=Math.abs(s),t=Math.abs(t)-s,Math.max(0,Qt(t)-Qt(s))+1}function Lu(s,t){switch(arguments.length){case 0:break;case 1:this.range(s);break;default:this.range(t).domain(s);break}return this}function Bu(s){return function(){return s}}function Pu(s){return+s}var Us=[0,1];function Xt(s){return s}function Ln(s,t){return(t-=s=+s)?function(e){return(e-s)/t}:Bu(isNaN(t)?NaN:.5)}function Vu(s,t){var e;return s>t&&(e=s,s=t,t=e),function(n){return Math.max(s,Math.min(t,n))}}function Uu(s,t,e){var n=s[0],r=s[1],i=t[0],o=t[1];return r<n?(n=Ln(r,n),i=e(o,i)):(n=Ln(n,r),i=e(i,o)),function(a){return i(n(a))}}function $u(s,t,e){var n=Math.min(s.length,t.length)-1,r=new Array(n),i=new Array(n),o=-1;for(s[n]<s[0]&&(s=s.slice().reverse(),t=t.slice().reverse());++o<n;)r[o]=Ln(s[o],s[o+1]),i[o]=e(t[o],t[o+1]);return function(a){var h=Qi(s,a,1,n)-1;return i[h](r[h](a))}}function Hu(s,t){return t.domain(s.domain()).range(s.range()).interpolate(s.interpolate()).clamp(s.clamp()).unknown(s.unknown())}function Gu(){var s=Us,t=Us,e=Zn,n,r,i,o=Xt,a,h,u;function c(){var f=Math.min(s.length,t.length);return o!==Xt&&(o=Vu(s[0],s[f-1])),a=f>2?$u:Uu,h=u=null,l}function l(f){return f==null||isNaN(f=+f)?i:(h||(h=a(s.map(n),t,e)))(n(o(f)))}return l.invert=function(f){return o(r((u||(u=a(t,s.map(n),ct)))(f)))},l.domain=function(f){return arguments.length?(s=Array.from(f,Pu),c()):s.slice()},l.range=function(f){return arguments.length?(t=Array.from(f),c()):t.slice()},l.rangeRound=function(f){return t=Array.from(f),e=uh,c()},l.clamp=function(f){return arguments.length?(o=f?!0:Xt,c()):o!==Xt},l.interpolate=function(f){return arguments.length?(e=f,c()):e},l.unknown=function(f){return arguments.length?(i=f,l):i},function(f,d){return n=f,r=d,c()}}function Xu(){return Gu()(Xt,Xt)}function Yu(s,t,e,n){var r=so(s,t,e),i;switch(n=Ke(n??",f"),n.type){case"s":{var o=Math.max(Math.abs(s),Math.abs(t));return n.precision==null&&!isNaN(i=ku(r,o))&&(n.precision=i),Vr(n,o)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(i=Du(r,Math.max(Math.abs(s),Math.abs(t))))&&(n.precision=i-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(i=Ou(r))&&(n.precision=i-(n.type==="%")*2);break}}return Pr(n)}function qu(s){var t=s.domain;return s.ticks=function(e){var n=t();return no(n[0],n[n.length-1],e??10)},s.tickFormat=function(e,n){var r=t();return Yu(r[0],r[r.length-1],e??10,n)},s.nice=function(e){e==null&&(e=10);var n=t(),r=0,i=n.length-1,o=n[r],a=n[i],h,u,c=10;for(a<o&&(u=o,o=a,a=u,u=r,r=i,i=u);c-- >0;){if(u=zn(o,a,e),u===h)return n[r]=o,n[i]=a,t(n);if(u>0)o=Math.floor(o/u)*u,a=Math.ceil(a/u)*u;else if(u<0)o=Math.ceil(o*u)/u,a=Math.floor(a*u)/u;else break;h=u}return s},s}function Ur(){var s=Xu();return s.copy=function(){return Hu(s,Ur())},Lu.apply(s,arguments),qu(s)}function ce(s,t,e){this.k=s,this.x=t,this.y=e}ce.prototype={constructor:ce,scale:function(s){return s===1?this:new ce(this.k*s,this.x,this.y)},translate:function(s,t){return s===0&t===0?this:new ce(this.k,this.x+this.k*s,this.y+this.k*t)},apply:function(s){return[s[0]*this.k+this.x,s[1]*this.k+this.y]},applyX:function(s){return s*this.k+this.x},applyY:function(s){return s*this.k+this.y},invert:function(s){return[(s[0]-this.x)/this.k,(s[1]-this.y)/this.k]},invertX:function(s){return(s-this.x)/this.k},invertY:function(s){return(s-this.y)/this.k},rescaleX:function(s){return s.copy().domain(s.range().map(this.invertX,this).map(s.invert,s))},rescaleY:function(s){return s.copy().domain(s.range().map(this.invertY,this).map(s.invert,s))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};ce.prototype;const $s={VERTEX:"vertex",FRAGMENT:"fragment"},G={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Ne=["x","y","z","w"],Z=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Hs=1234567;const $r=Math.PI/180,Hr=180/Math.PI;function Zt(){const s=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Z[s&255]+Z[s>>8&255]+Z[s>>16&255]+Z[s>>24&255]+"-"+Z[t&255]+Z[t>>8&255]+"-"+Z[t>>16&15|64]+Z[t>>24&255]+"-"+Z[e&63|128]+Z[e>>8&255]+"-"+Z[e>>16&255]+Z[e>>24&255]+Z[n&255]+Z[n>>8&255]+Z[n>>16&255]+Z[n>>24&255]).toLowerCase()}function z(s,t,e){return Math.max(t,Math.min(e,s))}function jn(s,t){return(s%t+t)%t}function Zu(s,t,e,n,r){return n+(s-t)*(r-n)/(e-t)}function Wu(s,t,e){return s!==t?(e-s)/(t-s):0}function le(s,t,e){return(1-e)*s+e*t}function Ku(s,t,e,n){return le(s,t,1-Math.exp(-e*n))}function Ju(s,t=1){return t-Math.abs(jn(s,t*2)-t)}function Qu(s,t,e){return s<=t?0:s>=e?1:(s=(s-t)/(e-t),s*s*(3-2*s))}function ju(s,t,e){return s<=t?0:s>=e?1:(s=(s-t)/(e-t),s*s*s*(s*(s*6-15)+10))}function tc(s,t){return s+Math.floor(Math.random()*(t-s+1))}function ec(s,t){return s+Math.random()*(t-s)}function nc(s){return s*(.5-Math.random())}function sc(s){s!==void 0&&(Hs=s);let t=Hs+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function rc(s){return s*$r}function ic(s){return s*Hr}function oc(s){return(s&s-1)===0&&s!==0}function ac(s){return Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function hc(s){return Math.pow(2,Math.floor(Math.log(s)/Math.LN2))}function uc(s,t,e,n,r){const i=Math.cos,o=Math.sin,a=i(e/2),h=o(e/2),u=i((t+n)/2),c=o((t+n)/2),l=i((t-n)/2),f=o((t-n)/2),d=i((n-t)/2),g=o((n-t)/2);switch(r){case"XYX":s.set(a*c,h*l,h*f,a*u);break;case"YZY":s.set(h*f,a*c,h*l,a*u);break;case"ZXZ":s.set(h*l,h*f,a*c,a*u);break;case"XZX":s.set(a*c,h*g,h*d,a*u);break;case"YXY":s.set(h*d,a*c,h*g,a*u);break;case"ZYZ":s.set(h*g,h*d,a*c,a*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function ft(s,t){switch(t.constructor){case Float32Array:return s;case Uint32Array:return s/4294967295;case Uint16Array:return s/65535;case Uint8Array:return s/255;case Int32Array:return Math.max(s/2147483647,-1);case Int16Array:return Math.max(s/32767,-1);case Int8Array:return Math.max(s/127,-1);default:throw new Error("Invalid component type.")}}function I(s,t){switch(t.constructor){case Float32Array:return s;case Uint32Array:return Math.round(s*4294967295);case Uint16Array:return Math.round(s*65535);case Uint8Array:return Math.round(s*255);case Int32Array:return Math.round(s*2147483647);case Int16Array:return Math.round(s*32767);case Int8Array:return Math.round(s*127);default:throw new Error("Invalid component type.")}}const cc={DEG2RAD:$r,RAD2DEG:Hr,generateUUID:Zt,clamp:z,euclideanModulo:jn,mapLinear:Zu,inverseLerp:Wu,lerp:le,damp:Ku,pingpong:Ju,smoothstep:Qu,smootherstep:ju,randInt:tc,randFloat:ec,randFloatSpread:nc,seededRandom:sc,degToRad:rc,radToDeg:ic,isPowerOfTwo:oc,ceilPowerOfTwo:ac,floorPowerOfTwo:hc,setQuaternionFromProperEuler:uc,normalize:I,denormalize:ft},lc=1,Bn=0,ts=300,fc=301,dc=302,Gs=1e3,be=1001,Xs=1002,Je=1003,Gr=1006,Xr=1008,pc=1009,gc=1013,Yr=1014,yc=1015,mc=1016,xc=1020,Nc=1023,wn=1026,Ys=1027,qs=0,wc=1,Qe="",ut="srgb",Zs="srgb-linear",Ws="linear",fe="srgb",je=35044,Bt=2e3,tn=2001;class wt{constructor(t,e,n,r,i,o,a,h,u){wt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,n,r,i,o,a,h,u)}set(t,e,n,r,i,o,a,h,u){const c=this.elements;return c[0]=t,c[1]=r,c[2]=a,c[3]=e,c[4]=i,c[5]=h,c[6]=n,c[7]=o,c[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,o=n[0],a=n[3],h=n[6],u=n[1],c=n[4],l=n[7],f=n[2],d=n[5],g=n[8],x=r[0],w=r[3],_=r[6],v=r[1],E=r[4],F=r[7],C=r[2],k=r[5],M=r[8];return i[0]=o*x+a*v+h*C,i[3]=o*w+a*E+h*k,i[6]=o*_+a*F+h*M,i[1]=u*x+c*v+l*C,i[4]=u*w+c*E+l*k,i[7]=u*_+c*F+l*M,i[2]=f*x+d*v+g*C,i[5]=f*w+d*E+g*k,i[8]=f*_+d*F+g*M,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],h=t[6],u=t[7],c=t[8];return e*o*c-e*a*u-n*i*c+n*a*h+r*i*u-r*o*h}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],h=t[6],u=t[7],c=t[8],l=c*o-a*u,f=a*h-c*i,d=u*i-o*h,g=e*l+n*f+r*d;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const x=1/g;return t[0]=l*x,t[1]=(r*u-c*n)*x,t[2]=(a*n-r*o)*x,t[3]=f*x,t[4]=(c*e-r*h)*x,t[5]=(r*i-a*e)*x,t[6]=d*x,t[7]=(n*h-u*e)*x,t[8]=(o*e-n*i)*x,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,i,o,a){const h=Math.cos(i),u=Math.sin(i);return this.set(n*h,n*u,-n*(h*o+u*a)+o+t,-r*u,r*h,-r*(-u*o+h*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(Tn.makeScale(t,e)),this}rotate(t){return this.premultiply(Tn.makeRotation(-t)),this}translate(t,e){return this.premultiply(Tn.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let r=0;r<9;r++)if(e[r]!==n[r])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Tn=new wt,Ks=new wt().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Js=new wt().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Tc(){const s={enabled:!0,workingColorSpace:Zs,spaces:{},convert:function(r,i,o){return this.enabled===!1||i===o||!i||!o||(this.spaces[i].transfer===fe&&(r.r=At(r.r),r.g=At(r.g),r.b=At(r.b)),this.spaces[i].primaries!==this.spaces[o].primaries&&(r.applyMatrix3(this.spaces[i].toXYZ),r.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===fe&&(r.r=Wt(r.r),r.g=Wt(r.g),r.b=Wt(r.b))),r},fromWorkingColorSpace:function(r,i){return this.convert(r,this.workingColorSpace,i)},toWorkingColorSpace:function(r,i){return this.convert(r,i,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===Qe?Ws:this.spaces[r].transfer},getLuminanceCoefficients:function(r,i=this.workingColorSpace){return r.fromArray(this.spaces[i].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,i,o){return r.copy(this.spaces[i].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],e=[.2126,.7152,.0722],n=[.3127,.329];return s.define({[Zs]:{primaries:t,whitePoint:n,transfer:Ws,toXYZ:Ks,fromXYZ:Js,luminanceCoefficients:e,workingColorSpaceConfig:{unpackColorSpace:ut},outputColorSpaceConfig:{drawingBufferColorSpace:ut}},[ut]:{primaries:t,whitePoint:n,transfer:fe,toXYZ:Ks,fromXYZ:Js,luminanceCoefficients:e,outputColorSpaceConfig:{drawingBufferColorSpace:ut}}}),s}const H=Tc();function At(s){return s<.04045?s*.0773993808:Math.pow(s*.9478672986+.0521327014,2.4)}function Wt(s){return s<.0031308?s*12.92:1.055*Math.pow(s,.41666)-.055}const qr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Rt={h:0,s:0,l:0},Ie={h:0,s:0,l:0};function _n(s,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?s+(t-s)*6*e:e<1/2?t:e<2/3?s+(t-s)*6*(2/3-e):s}class es{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(e===void 0&&n===void 0){const r=t;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=ut){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,H.toWorkingColorSpace(this,e),this}setRGB(t,e,n,r=H.workingColorSpace){return this.r=t,this.g=e,this.b=n,H.toWorkingColorSpace(this,r),this}setHSL(t,e,n,r=H.workingColorSpace){if(t=jn(t,1),e=z(e,0,1),n=z(n,0,1),e===0)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,o=2*n-i;this.r=_n(o,i,t+1/3),this.g=_n(o,i,t),this.b=_n(o,i,t-1/3)}return H.toWorkingColorSpace(this,r),this}setStyle(t,e=ut){function n(i){i!==void 0&&parseFloat(i)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(t)){let i;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,e);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,e);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){const i=r[1],o=i.length;if(o===3)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,e);if(o===6)return this.setHex(parseInt(i,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=ut){const n=qr[t.toLowerCase()];return n!==void 0?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=At(t.r),this.g=At(t.g),this.b=At(t.b),this}copyLinearToSRGB(t){return this.r=Wt(t.r),this.g=Wt(t.g),this.b=Wt(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=ut){return H.fromWorkingColorSpace(W.copy(this),t),Math.round(z(W.r*255,0,255))*65536+Math.round(z(W.g*255,0,255))*256+Math.round(z(W.b*255,0,255))}getHexString(t=ut){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=H.workingColorSpace){H.fromWorkingColorSpace(W.copy(this),e);const n=W.r,r=W.g,i=W.b,o=Math.max(n,r,i),a=Math.min(n,r,i);let h,u;const c=(a+o)/2;if(a===o)h=0,u=0;else{const l=o-a;switch(u=c<=.5?l/(o+a):l/(2-o-a),o){case n:h=(r-i)/l+(r<i?6:0);break;case r:h=(i-n)/l+2;break;case i:h=(n-r)/l+4;break}h/=6}return t.h=h,t.s=u,t.l=c,t}getRGB(t,e=H.workingColorSpace){return H.fromWorkingColorSpace(W.copy(this),e),t.r=W.r,t.g=W.g,t.b=W.b,t}getStyle(t=ut){H.fromWorkingColorSpace(W.copy(this),t);const e=W.r,n=W.g,r=W.b;return t!==ut?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(n*255)},${Math.round(r*255)})`}offsetHSL(t,e,n){return this.getHSL(Rt),this.setHSL(Rt.h+t,Rt.s+e,Rt.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Rt),t.getHSL(Ie);const n=le(Rt.h,Ie.h,e),r=le(Rt.s,Ie.s,e),i=le(Rt.l,Ie.l,e);return this.setHSL(n,r,i),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,n=this.g,r=this.b,i=t.elements;return this.r=i[0]*e+i[3]*n+i[6]*r,this.g=i[1]*e+i[4]*n+i[7]*r,this.b=i[2]*e+i[5]*n+i[8]*r,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const W=new es;es.NAMES=qr;class Zr{constructor(t=0,e=0,n=0,r=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=r}static slerpFlat(t,e,n,r,i,o,a){let h=n[r+0],u=n[r+1],c=n[r+2],l=n[r+3];const f=i[o+0],d=i[o+1],g=i[o+2],x=i[o+3];if(a===0){t[e+0]=h,t[e+1]=u,t[e+2]=c,t[e+3]=l;return}if(a===1){t[e+0]=f,t[e+1]=d,t[e+2]=g,t[e+3]=x;return}if(l!==x||h!==f||u!==d||c!==g){let w=1-a;const _=h*f+u*d+c*g+l*x,v=_>=0?1:-1,E=1-_*_;if(E>Number.EPSILON){const C=Math.sqrt(E),k=Math.atan2(C,_*v);w=Math.sin(w*k)/C,a=Math.sin(a*k)/C}const F=a*v;if(h=h*w+f*F,u=u*w+d*F,c=c*w+g*F,l=l*w+x*F,w===1-a){const C=1/Math.sqrt(h*h+u*u+c*c+l*l);h*=C,u*=C,c*=C,l*=C}}t[e]=h,t[e+1]=u,t[e+2]=c,t[e+3]=l}static multiplyQuaternionsFlat(t,e,n,r,i,o){const a=n[r],h=n[r+1],u=n[r+2],c=n[r+3],l=i[o],f=i[o+1],d=i[o+2],g=i[o+3];return t[e]=a*g+c*l+h*d-u*f,t[e+1]=h*g+c*f+u*l-a*d,t[e+2]=u*g+c*d+a*f-h*l,t[e+3]=c*g-a*l-h*f-u*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const n=t._x,r=t._y,i=t._z,o=t._order,a=Math.cos,h=Math.sin,u=a(n/2),c=a(r/2),l=a(i/2),f=h(n/2),d=h(r/2),g=h(i/2);switch(o){case"XYZ":this._x=f*c*l+u*d*g,this._y=u*d*l-f*c*g,this._z=u*c*g+f*d*l,this._w=u*c*l-f*d*g;break;case"YXZ":this._x=f*c*l+u*d*g,this._y=u*d*l-f*c*g,this._z=u*c*g-f*d*l,this._w=u*c*l+f*d*g;break;case"ZXY":this._x=f*c*l-u*d*g,this._y=u*d*l+f*c*g,this._z=u*c*g+f*d*l,this._w=u*c*l-f*d*g;break;case"ZYX":this._x=f*c*l-u*d*g,this._y=u*d*l+f*c*g,this._z=u*c*g-f*d*l,this._w=u*c*l+f*d*g;break;case"YZX":this._x=f*c*l+u*d*g,this._y=u*d*l+f*c*g,this._z=u*c*g-f*d*l,this._w=u*c*l-f*d*g;break;case"XZY":this._x=f*c*l-u*d*g,this._y=u*d*l-f*c*g,this._z=u*c*g+f*d*l,this._w=u*c*l+f*d*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],r=e[4],i=e[8],o=e[1],a=e[5],h=e[9],u=e[2],c=e[6],l=e[10],f=n+a+l;if(f>0){const d=.5/Math.sqrt(f+1);this._w=.25/d,this._x=(c-h)*d,this._y=(i-u)*d,this._z=(o-r)*d}else if(n>a&&n>l){const d=2*Math.sqrt(1+n-a-l);this._w=(c-h)/d,this._x=.25*d,this._y=(r+o)/d,this._z=(i+u)/d}else if(a>l){const d=2*Math.sqrt(1+a-n-l);this._w=(i-u)/d,this._x=(r+o)/d,this._y=.25*d,this._z=(h+c)/d}else{const d=2*Math.sqrt(1+l-n-a);this._w=(o-r)/d,this._x=(i+u)/d,this._y=(h+c)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(z(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(n===0)return this;const r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,r=t._y,i=t._z,o=t._w,a=e._x,h=e._y,u=e._z,c=e._w;return this._x=n*c+o*a+r*u-i*h,this._y=r*c+o*h+i*a-n*u,this._z=i*c+o*u+n*h-r*a,this._w=o*c-n*a-r*h-i*u,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const n=this._x,r=this._y,i=this._z,o=this._w;let a=o*t._w+n*t._x+r*t._y+i*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;const h=1-a*a;if(h<=Number.EPSILON){const d=1-e;return this._w=d*o+e*this._w,this._x=d*n+e*this._x,this._y=d*r+e*this._y,this._z=d*i+e*this._z,this.normalize(),this}const u=Math.sqrt(h),c=Math.atan2(u,a),l=Math.sin((1-e)*c)/u,f=Math.sin(e*c)/u;return this._w=o*l+this._w*f,this._x=n*l+this._x*f,this._y=r*l+this._y*f,this._z=i*l+this._z*f,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(t),r*Math.cos(t),i*Math.sin(e),i*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class L{constructor(t=0,e=0,n=0){L.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return n===void 0&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Qs.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Qs.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=t.elements,o=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*o,this}applyQuaternion(t){const e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,a=t.z,h=t.w,u=2*(o*r-a*n),c=2*(a*e-i*r),l=2*(i*n-o*e);return this.x=e+h*u+o*l-a*c,this.y=n+h*c+a*u-i*l,this.z=r+h*l+i*c-o*u,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=z(this.x,t.x,e.x),this.y=z(this.y,t.y,e.y),this.z=z(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=z(this.x,t,e),this.y=z(this.y,t,e),this.z=z(this.z,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(z(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,r=t.y,i=t.z,o=e.x,a=e.y,h=e.z;return this.x=r*h-i*a,this.y=i*o-n*h,this.z=n*a-r*o,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Mn.copy(this).projectOnVector(t),this.sub(Mn)}reflect(t){return this.sub(Mn.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(z(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=Math.random()*2-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Mn=new L,Qs=new Zr;class It{constructor(t,e,n,r,i,o,a,h,u,c,l,f,d,g,x,w){It.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,n,r,i,o,a,h,u,c,l,f,d,g,x,w)}set(t,e,n,r,i,o,a,h,u,c,l,f,d,g,x,w){const _=this.elements;return _[0]=t,_[4]=e,_[8]=n,_[12]=r,_[1]=i,_[5]=o,_[9]=a,_[13]=h,_[2]=u,_[6]=c,_[10]=l,_[14]=f,_[3]=d,_[7]=g,_[11]=x,_[15]=w,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new It().fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,r=1/Ht.setFromMatrixColumn(t,0).length(),i=1/Ht.setFromMatrixColumn(t,1).length(),o=1/Ht.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,r=t.y,i=t.z,o=Math.cos(n),a=Math.sin(n),h=Math.cos(r),u=Math.sin(r),c=Math.cos(i),l=Math.sin(i);if(t.order==="XYZ"){const f=o*c,d=o*l,g=a*c,x=a*l;e[0]=h*c,e[4]=-h*l,e[8]=u,e[1]=d+g*u,e[5]=f-x*u,e[9]=-a*h,e[2]=x-f*u,e[6]=g+d*u,e[10]=o*h}else if(t.order==="YXZ"){const f=h*c,d=h*l,g=u*c,x=u*l;e[0]=f+x*a,e[4]=g*a-d,e[8]=o*u,e[1]=o*l,e[5]=o*c,e[9]=-a,e[2]=d*a-g,e[6]=x+f*a,e[10]=o*h}else if(t.order==="ZXY"){const f=h*c,d=h*l,g=u*c,x=u*l;e[0]=f-x*a,e[4]=-o*l,e[8]=g+d*a,e[1]=d+g*a,e[5]=o*c,e[9]=x-f*a,e[2]=-o*u,e[6]=a,e[10]=o*h}else if(t.order==="ZYX"){const f=o*c,d=o*l,g=a*c,x=a*l;e[0]=h*c,e[4]=g*u-d,e[8]=f*u+x,e[1]=h*l,e[5]=x*u+f,e[9]=d*u-g,e[2]=-u,e[6]=a*h,e[10]=o*h}else if(t.order==="YZX"){const f=o*h,d=o*u,g=a*h,x=a*u;e[0]=h*c,e[4]=x-f*l,e[8]=g*l+d,e[1]=l,e[5]=o*c,e[9]=-a*c,e[2]=-u*c,e[6]=d*l+g,e[10]=f-x*l}else if(t.order==="XZY"){const f=o*h,d=o*u,g=a*h,x=a*u;e[0]=h*c,e[4]=-l,e[8]=u*c,e[1]=f*l+x,e[5]=o*c,e[9]=d*l-g,e[2]=g*l-d,e[6]=a*c,e[10]=x*l+f}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(_c,t,Mc)}lookAt(t,e,n){const r=this.elements;return it.subVectors(t,e),it.lengthSq()===0&&(it.z=1),it.normalize(),bt.crossVectors(n,it),bt.lengthSq()===0&&(Math.abs(n.z)===1?it.x+=1e-4:it.z+=1e-4,it.normalize(),bt.crossVectors(n,it)),bt.normalize(),Oe.crossVectors(it,bt),r[0]=bt.x,r[4]=Oe.x,r[8]=it.x,r[1]=bt.y,r[5]=Oe.y,r[9]=it.y,r[2]=bt.z,r[6]=Oe.z,r[10]=it.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,o=n[0],a=n[4],h=n[8],u=n[12],c=n[1],l=n[5],f=n[9],d=n[13],g=n[2],x=n[6],w=n[10],_=n[14],v=n[3],E=n[7],F=n[11],C=n[15],k=r[0],M=r[4],X=r[8],J=r[12],Y=r[1],A=r[5],Q=r[9],q=r[13],at=r[2],kt=r[6],_t=r[10],Mt=r[14],St=r[3],j=r[7],Ae=r[11],Ee=r[15];return i[0]=o*k+a*Y+h*at+u*St,i[4]=o*M+a*A+h*kt+u*j,i[8]=o*X+a*Q+h*_t+u*Ae,i[12]=o*J+a*q+h*Mt+u*Ee,i[1]=c*k+l*Y+f*at+d*St,i[5]=c*M+l*A+f*kt+d*j,i[9]=c*X+l*Q+f*_t+d*Ae,i[13]=c*J+l*q+f*Mt+d*Ee,i[2]=g*k+x*Y+w*at+_*St,i[6]=g*M+x*A+w*kt+_*j,i[10]=g*X+x*Q+w*_t+_*Ae,i[14]=g*J+x*q+w*Mt+_*Ee,i[3]=v*k+E*Y+F*at+C*St,i[7]=v*M+E*A+F*kt+C*j,i[11]=v*X+E*Q+F*_t+C*Ae,i[15]=v*J+E*q+F*Mt+C*Ee,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],o=t[1],a=t[5],h=t[9],u=t[13],c=t[2],l=t[6],f=t[10],d=t[14],g=t[3],x=t[7],w=t[11],_=t[15];return g*(+i*h*l-r*u*l-i*a*f+n*u*f+r*a*d-n*h*d)+x*(+e*h*d-e*u*f+i*o*f-r*o*d+r*u*c-i*h*c)+w*(+e*u*l-e*a*d-i*o*l+n*o*d+i*a*c-n*u*c)+_*(-r*a*c-e*h*l+e*a*f+r*o*l-n*o*f+n*h*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],h=t[6],u=t[7],c=t[8],l=t[9],f=t[10],d=t[11],g=t[12],x=t[13],w=t[14],_=t[15],v=l*w*u-x*f*u+x*h*d-a*w*d-l*h*_+a*f*_,E=g*f*u-c*w*u-g*h*d+o*w*d+c*h*_-o*f*_,F=c*x*u-g*l*u+g*a*d-o*x*d-c*a*_+o*l*_,C=g*l*h-c*x*h-g*a*f+o*x*f+c*a*w-o*l*w,k=e*v+n*E+r*F+i*C;if(k===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/k;return t[0]=v*M,t[1]=(x*f*i-l*w*i-x*r*d+n*w*d+l*r*_-n*f*_)*M,t[2]=(a*w*i-x*h*i+x*r*u-n*w*u-a*r*_+n*h*_)*M,t[3]=(l*h*i-a*f*i-l*r*u+n*f*u+a*r*d-n*h*d)*M,t[4]=E*M,t[5]=(c*w*i-g*f*i+g*r*d-e*w*d-c*r*_+e*f*_)*M,t[6]=(g*h*i-o*w*i-g*r*u+e*w*u+o*r*_-e*h*_)*M,t[7]=(o*f*i-c*h*i+c*r*u-e*f*u-o*r*d+e*h*d)*M,t[8]=F*M,t[9]=(g*l*i-c*x*i-g*n*d+e*x*d+c*n*_-e*l*_)*M,t[10]=(o*x*i-g*a*i+g*n*u-e*x*u-o*n*_+e*a*_)*M,t[11]=(c*a*i-o*l*i-c*n*u+e*l*u+o*n*d-e*a*d)*M,t[12]=C*M,t[13]=(c*x*r-g*l*r+g*n*f-e*x*f-c*n*w+e*l*w)*M,t[14]=(g*a*r-o*x*r-g*n*h+e*x*h+o*n*w-e*a*w)*M,t[15]=(o*l*r-c*a*r+c*n*h-e*l*h-o*n*f+e*a*f)*M,this}scale(t){const e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),r=Math.sin(e),i=1-n,o=t.x,a=t.y,h=t.z,u=i*o,c=i*a;return this.set(u*o+n,u*a-r*h,u*h+r*a,0,u*a+r*h,c*a+n,c*h-r*o,0,u*h-r*a,c*h+r*o,i*h*h+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,r,i,o){return this.set(1,n,i,0,t,1,o,0,e,r,1,0,0,0,0,1),this}compose(t,e,n){const r=this.elements,i=e._x,o=e._y,a=e._z,h=e._w,u=i+i,c=o+o,l=a+a,f=i*u,d=i*c,g=i*l,x=o*c,w=o*l,_=a*l,v=h*u,E=h*c,F=h*l,C=n.x,k=n.y,M=n.z;return r[0]=(1-(x+_))*C,r[1]=(d+F)*C,r[2]=(g-E)*C,r[3]=0,r[4]=(d-F)*k,r[5]=(1-(f+_))*k,r[6]=(w+v)*k,r[7]=0,r[8]=(g+E)*M,r[9]=(w-v)*M,r[10]=(1-(f+x))*M,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){const r=this.elements;let i=Ht.set(r[0],r[1],r[2]).length();const o=Ht.set(r[4],r[5],r[6]).length(),a=Ht.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],ht.copy(this);const u=1/i,c=1/o,l=1/a;return ht.elements[0]*=u,ht.elements[1]*=u,ht.elements[2]*=u,ht.elements[4]*=c,ht.elements[5]*=c,ht.elements[6]*=c,ht.elements[8]*=l,ht.elements[9]*=l,ht.elements[10]*=l,e.setFromRotationMatrix(ht),n.x=i,n.y=o,n.z=a,this}makePerspective(t,e,n,r,i,o,a=Bt){const h=this.elements,u=2*i/(e-t),c=2*i/(n-r),l=(e+t)/(e-t),f=(n+r)/(n-r);let d,g;if(a===Bt)d=-(o+i)/(o-i),g=-2*o*i/(o-i);else if(a===tn)d=-o/(o-i),g=-o*i/(o-i);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return h[0]=u,h[4]=0,h[8]=l,h[12]=0,h[1]=0,h[5]=c,h[9]=f,h[13]=0,h[2]=0,h[6]=0,h[10]=d,h[14]=g,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(t,e,n,r,i,o,a=Bt){const h=this.elements,u=1/(e-t),c=1/(n-r),l=1/(o-i),f=(e+t)*u,d=(n+r)*c;let g,x;if(a===Bt)g=(o+i)*l,x=-2*l;else if(a===tn)g=i*l,x=-1*l;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return h[0]=2*u,h[4]=0,h[8]=0,h[12]=-f,h[1]=0,h[5]=2*c,h[9]=0,h[13]=-d,h[2]=0,h[6]=0,h[10]=x,h[14]=-g,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const Ht=new L,ht=new It,_c=new L(0,0,0),Mc=new L(1,1,1),bt=new L,Oe=new L,it=new L;class ot{constructor(t=0,e=0){ot.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=z(this.x,t.x,e.x),this.y=z(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=z(this.x,t,e),this.y=z(this.y,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(z(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(z(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,o=this.y-t.y;return this.x=i*n-o*r+t.x,this.y=i*r+o*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ot{constructor(t=0,e=0,n=0,r=1){Ot.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*e+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*e+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*e+o[7]*n+o[11]*r+o[15]*i,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,i;const h=t.elements,u=h[0],c=h[4],l=h[8],f=h[1],d=h[5],g=h[9],x=h[2],w=h[6],_=h[10];if(Math.abs(c-f)<.01&&Math.abs(l-x)<.01&&Math.abs(g-w)<.01){if(Math.abs(c+f)<.1&&Math.abs(l+x)<.1&&Math.abs(g+w)<.1&&Math.abs(u+d+_-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const E=(u+1)/2,F=(d+1)/2,C=(_+1)/2,k=(c+f)/4,M=(l+x)/4,X=(g+w)/4;return E>F&&E>C?E<.01?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(E),r=k/n,i=M/n):F>C?F<.01?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(F),n=k/r,i=X/r):C<.01?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(C),n=M/i,r=X/i),this.set(n,r,i,e),this}let v=Math.sqrt((w-g)*(w-g)+(l-x)*(l-x)+(f-c)*(f-c));return Math.abs(v)<.001&&(v=1),this.x=(w-g)/v,this.y=(l-x)/v,this.z=(f-c)/v,this.w=Math.acos((u+d+_-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=z(this.x,t.x,e.x),this.y=z(this.y,t.y,e.y),this.z=z(this.z,t.z,e.z),this.w=z(this.w,t.w,e.w),this}clampScalar(t,e){return this.x=z(this.x,t,e),this.y=z(this.y,t,e),this.z=z(this.z,t,e),this.w=z(this.w,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(z(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}function Pn(s,t=0){let e=3735928559^t,n=1103547991^t;if(s instanceof Array)for(let r=0,i;r<s.length;r++)i=s[r],e=Math.imul(e^i,2654435761),n=Math.imul(n^i,1597334677);else for(let r=0,i;r<s.length;r++)i=s.charCodeAt(r),e=Math.imul(e^i,2654435761),n=Math.imul(n^i,1597334677);return e=Math.imul(e^e>>>16,2246822507),e^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(e^e>>>13,3266489909),4294967296*(2097151&n)+(e>>>0)}const Wr=(...s)=>Pn(s);function Sc(s,t=!1){const e=[];s.isNode===!0&&(e.push(s.id),s=s.getSelf());for(const{property:n,childNode:r}of Vn(s))e.push(e,Pn(n.slice(0,-4)),r.getCacheKey(t));return Pn(e)}function*Vn(s,t=!1){for(const e in s){if(e.startsWith("_")===!0)continue;const n=s[e];if(Array.isArray(n)===!0)for(let r=0;r<n.length;r++){const i=n[r];i&&(i.isNode===!0||t&&typeof i.toJSON=="function")&&(yield{property:e,index:r,childNode:i})}else if(n&&n.isNode===!0)yield{property:e,childNode:n};else if(typeof n=="object")for(const r in n){const i=n[r];i&&(i.isNode===!0||t&&typeof i.toJSON=="function")&&(yield{property:e,index:r,childNode:i})}}}function en(s){if(s==null)return null;const t=typeof s;return s.isNode===!0?"node":t==="number"?"float":t==="boolean"?"bool":t==="string"?"string":t==="function"?"shader":s.isVector2===!0?"vec2":s.isVector3===!0?"vec3":s.isVector4===!0?"vec4":s.isMatrix3===!0?"mat3":s.isMatrix4===!0?"mat4":s.isColor===!0?"color":s instanceof ArrayBuffer?"ArrayBuffer":null}function Kr(s,...t){const e=s?s.slice(-4):void 0;return t.length===1&&(e==="vec2"?t=[t[0],t[0]]:e==="vec3"?t=[t[0],t[0],t[0]]:e==="vec4"&&(t=[t[0],t[0],t[0],t[0]])),s==="color"?new es(...t):e==="vec2"?new ot(...t):e==="vec3"?new L(...t):e==="vec4"?new Ot(...t):e==="mat3"?new wt(...t):e==="mat4"?new It(...t):s==="bool"?t[0]||!1:s==="float"||s==="int"||s==="uint"?t[0]||0:s==="string"?t[0]||"":s==="ArrayBuffer"?Ac(t[0]):null}function Cc(s){let t="";const e=new Uint8Array(s);for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function Ac(s){return Uint8Array.from(atob(s),t=>t.charCodeAt(0)).buffer}class ns{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const n=this._listeners;return n[t]!==void 0&&n[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const r=this._listeners[t];if(r!==void 0){const i=r.indexOf(e);i!==-1&&r.splice(i,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const n=this._listeners[t.type];if(n!==void 0){t.target=this;const r=n.slice(0);for(let i=0,o=r.length;i<o;i++)r[i].call(this,t);t.target=null}}}let Ec=0;class b extends ns{static get type(){return"Node"}constructor(t=null){super(),this.nodeType=t,this.updateType=G.NONE,this.updateBeforeType=G.NONE,this.updateAfterType=G.NONE,this.uuid=cc.generateUUID(),this.version=0,this.global=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:Ec++})}set needsUpdate(t){t===!0&&this.version++}get type(){return this.constructor.type}onUpdate(t,e){return this.updateType=e,this.update=t.bind(this.getSelf()),this}onFrameUpdate(t){return this.onUpdate(t,G.FRAME)}onRenderUpdate(t){return this.onUpdate(t,G.RENDER)}onObjectUpdate(t){return this.onUpdate(t,G.OBJECT)}onReference(t){return this.updateReference=t.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:t}of Vn(this))yield t}dispose(){this.dispatchEvent({type:"dispose"})}traverse(t){t(this);for(const e of this.getChildren())e.traverse(t)}getCacheKey(t=!1){return t=t||this.version!==this._cacheKeyVersion,(t===!0||this._cacheKey===null)&&(this._cacheKey=Wr(Sc(this,t),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(t){const e=this.getNodeType(t);return t.getElementType(e)}getNodeType(t){const e=t.getNodeProperties(this);return e.outputNode?e.outputNode.getNodeType(t):this.nodeType}getShared(t){const e=this.getHash(t);return t.getNodeFromHash(e)||this}setup(t){const e=t.getNodeProperties(this);let n=0;for(const r of this.getChildren())e["node"+n++]=r;return e.outputNode||null}analyze(t){if(t.increaseUsage(this)===1){const n=t.getNodeProperties(this);for(const r of Object.values(n))r&&r.isNode===!0&&r.build(t)}}generate(t,e){const{outputNode:n}=t.getNodeProperties(this);if(n&&n.isNode===!0)return n.build(t,e)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(t,e=null){const n=this.getShared(t);if(this!==n)return n.build(t,e);t.addNode(this),t.addChain(this);let r=null;const i=t.getBuildStage();if(i==="setup"){this.updateReference(t);const o=t.getNodeProperties(this);if(o.initialized!==!0){o.initialized=!0;const a=this.setup(t),h=a&&a.isNode===!0;for(const u of Object.values(o))u&&u.isNode===!0&&u.build(t);h&&a.build(t),o.outputNode=a}}else if(i==="analyze")this.analyze(t);else if(i==="generate")if(this.generate.length===1){const a=this.getNodeType(t),h=t.getDataFromNode(this);r=h.snippet,r===void 0?(r=this.generate(t)||"",h.snippet=r):h.flowCodes!==void 0&&t.context.nodeBlock!==void 0&&t.addFlowCodeHierarchy(this,t.context.nodeBlock),r=t.format(r,a,e)}else r=this.generate(t,e)||"";return t.removeChain(this),t.addSequentialNode(this),r}getSerializeChildren(){return Vn(this)}serialize(t){const e=this.getSerializeChildren(),n={};for(const{property:r,index:i,childNode:o}of e)i!==void 0?(n[r]===void 0&&(n[r]=Number.isInteger(i)?[]:{}),n[r][i]=o.toJSON(t.meta).uuid):n[r]=o.toJSON(t.meta).uuid;Object.keys(n).length>0&&(t.inputNodes=n)}deserialize(t){if(t.inputNodes!==void 0){const e=t.meta.nodes;for(const n in t.inputNodes)if(Array.isArray(t.inputNodes[n])){const r=[];for(const i of t.inputNodes[n])r.push(e[i]);this[n]=r}else if(typeof t.inputNodes[n]=="object"){const r={};for(const i in t.inputNodes[n]){const o=t.inputNodes[n][i];r[i]=e[o]}this[n]=r}else{const r=t.inputNodes[n];this[n]=e[r]}}}toJSON(t){const{uuid:e,type:n}=this,r=t===void 0||typeof t=="string";r&&(t={textures:{},images:{},nodes:{}});let i=t.nodes[e];i===void 0&&(i={uuid:e,type:n,meta:t,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},r!==!0&&(t.nodes[i.uuid]=i),this.serialize(i),delete i.meta);function o(a){const h=[];for(const u in a){const c=a[u];delete c.metadata,h.push(c)}return h}if(r){const a=o(t.textures),h=o(t.images),u=o(t.nodes);a.length>0&&(i.textures=a),h.length>0&&(i.images=h),u.length>0&&(i.nodes=u)}return i}}class rt extends b{static get type(){return"TempNode"}constructor(t=null){super(t),this.isTempNode=!0}hasDependencies(t){return t.getDataFromNode(this).usageCount>1}build(t,e){if(t.getBuildStage()==="generate"){const r=t.getVectorType(this.getNodeType(t,e)),i=t.getDataFromNode(this);if(i.propertyName!==void 0)return t.format(i.propertyName,r,e);if(r!=="void"&&e!=="void"&&this.hasDependencies(t)){const o=super.build(t,r),a=t.getVarFromNode(this,null,r),h=t.getPropertyName(a);return t.addLineFlowCode(`${h} = ${o}`,this),i.snippet=o,i.propertyName=h,t.format(i.propertyName,r,e)}}return super.build(t,e)}}class we extends b{static get type(){return"ArrayElementNode"}constructor(t,e){super(),this.node=t,this.indexNode=e,this.isArrayElementNode=!0}getNodeType(t){return this.node.getElementType(t)}generate(t){const e=this.node.build(t),n=this.indexNode.build(t,"uint");return`${e}[ ${n} ]`}}class Jr extends b{static get type(){return"ConvertNode"}constructor(t,e){super(),this.node=t,this.convertTo=e}getNodeType(t){const e=this.node.getNodeType(t);let n=null;for(const r of this.convertTo.split("|"))(n===null||t.getTypeLength(e)===t.getTypeLength(r))&&(n=r);return n}serialize(t){super.serialize(t),t.convertTo=this.convertTo}deserialize(t){super.deserialize(t),this.convertTo=t.convertTo}generate(t,e){const n=this.node,r=this.getNodeType(t),i=n.build(t,r);return t.format(i,r,e)}}class vc extends rt{static get type(){return"JoinNode"}constructor(t=[],e=null){super(e),this.nodes=t}getNodeType(t){return this.nodeType!==null?t.getVectorType(this.nodeType):t.getTypeFromLength(this.nodes.reduce((e,n)=>e+t.getTypeLength(n.getNodeType(t)),0))}generate(t,e){const n=this.getNodeType(t),r=this.nodes,i=t.getComponentType(n),o=[];for(const h of r){let u=h.build(t);const c=t.getComponentType(h.getNodeType(t));c!==i&&(u=t.format(u,c,i)),o.push(u)}const a=`${t.getType(n)}( ${o.join(", ")} )`;return t.format(a,n,e)}}const zc=Ne.join("");class js extends b{static get type(){return"SplitNode"}constructor(t,e="x"){super(),this.node=t,this.components=e,this.isSplitNode=!0}getVectorLength(){let t=this.components.length;for(const e of this.components)t=Math.max(Ne.indexOf(e)+1,t);return t}getComponentType(t){return t.getComponentType(this.node.getNodeType(t))}getNodeType(t){return t.getTypeFromLength(this.components.length,this.getComponentType(t))}generate(t,e){const n=this.node,r=t.getTypeLength(n.getNodeType(t));let i=null;if(r>1){let o=null;this.getVectorLength()>=r&&(o=t.getTypeFromLength(this.getVectorLength(),this.getComponentType(t)));const h=n.build(t,o);this.components.length===r&&this.components===zc.slice(0,this.components.length)?i=t.format(h,o,e):i=t.format(`${h}.${this.components}`,this.getNodeType(t),e)}else i=n.build(t,e);return i}serialize(t){super.serialize(t),t.components=this.components}deserialize(t){super.deserialize(t),this.components=t.components}}class Fc extends rt{static get type(){return"SetNode"}constructor(t,e,n){super(),this.sourceNode=t,this.components=e,this.targetNode=n}getNodeType(t){return this.sourceNode.getNodeType(t)}generate(t){const{sourceNode:e,components:n,targetNode:r}=this,i=this.getNodeType(t),o=t.getComponentType(r.getNodeType(t)),a=t.getTypeFromLength(n.length,o),h=r.build(t,a),u=e.build(t,i),c=t.getTypeLength(i),l=[];for(let f=0;f<c;f++){const d=Ne[f];d===n[0]?(l.push(h),f+=n.length-1):l.push(u+"."+d)}return`${t.getType(i)}( ${l.join(", ")} )`}}class Rc extends rt{static get type(){return"FlipNode"}constructor(t,e){super(),this.sourceNode=t,this.components=e}getNodeType(t){return this.sourceNode.getNodeType(t)}generate(t){const{components:e,sourceNode:n}=this,r=this.getNodeType(t),i=n.build(t),o=t.getVarFromNode(this),a=t.getPropertyName(o);t.addLineFlowCode(a+" = "+i,this);const h=t.getTypeLength(r),u=[];let c=0;for(let l=0;l<h;l++){const f=Ne[l];f===e[c]?(u.push("1.0 - "+(a+"."+f)),c++):u.push(a+"."+f)}return`${t.getType(r)}( ${u.join(", ")} )`}}class ss extends b{static get type(){return"InputNode"}constructor(t,e=null){super(e),this.isInputNode=!0,this.value=t,this.precision=null}getNodeType(){return this.nodeType===null?en(this.value):this.nodeType}getInputType(t){return this.getNodeType(t)}setPrecision(t){return this.precision=t,this}serialize(t){super.serialize(t),t.value=this.value,this.value&&this.value.toArray&&(t.value=this.value.toArray()),t.valueType=en(this.value),t.nodeType=this.nodeType,t.valueType==="ArrayBuffer"&&(t.value=Cc(t.value)),t.precision=this.precision}deserialize(t){super.deserialize(t),this.nodeType=t.nodeType,this.value=Array.isArray(t.value)?Kr(t.valueType,...t.value):t.value,this.precision=t.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(t.value))}generate(){console.warn("Abstract function.")}}class Ft extends ss{static get type(){return"ConstNode"}constructor(t,e=null){super(t,e),this.isConstNode=!0}generateConst(t){return t.generateConst(this.getNodeType(t),this.value)}generate(t,e){const n=this.getNodeType(t);return t.format(this.generateConst(t),n,e)}}let Qr=null;const Yt=new Map;function m(s,t){if(Yt.has(s)){console.warn(`Redefinition of method chaining ${s}`);return}if(typeof t!="function")throw new Error(`Node element ${s} is not a function`);Yt.set(s,t)}const jr=s=>s.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),tr=s=>jr(s).split("").sort().join(""),ti={setup(s,t){const e=t.shift();return s(un(e),...t)},get(s,t,e){if(typeof t=="string"&&s[t]===void 0){if(s.isStackNode!==!0&&t==="assign")return(...n)=>(Qr.assign(e,...n),e);if(Yt.has(t)){const n=Yt.get(t);return s.isStackNode?(...r)=>e.add(n(...r)):(...r)=>n(e,...r)}else{if(t==="self")return s;if(t.endsWith("Assign")&&Yt.has(t.slice(0,t.length-6))){const n=Yt.get(t.slice(0,t.length-6));return s.isStackNode?(...r)=>e.assign(r[0],n(...r)):(...r)=>e.assign(n(e,...r))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(t)===!0)return t=jr(t),T(new js(e,t));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(t)===!0)return t=tr(t.slice(3).toLowerCase()),n=>T(new Fc(s,t,n));if(/^flip[XYZWRGBASTPQ]{1,4}$/.test(t)===!0)return t=tr(t.slice(4).toLowerCase()),()=>T(new Rc(T(s),t));if(t==="width"||t==="height"||t==="depth")return t==="width"?t="x":t==="height"?t="y":t==="depth"&&(t="z"),T(new js(s,t));if(/^\d+$/.test(t)===!0)return T(new we(e,new Ft(Number(t),"uint")))}}}return Reflect.get(s,t,e)},set(s,t,e,n){return typeof t=="string"&&s[t]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(t)===!0||t==="width"||t==="height"||t==="depth"||/^\d+$/.test(t)===!0)?(n[t].assign(e),!0):Reflect.set(s,t,e,n)}},Sn=new WeakMap,er=new WeakMap,bc=function(s,t=null){const e=en(s);if(e==="node"){let n=Sn.get(s);return n===void 0&&(n=new Proxy(s,ti),Sn.set(s,n),Sn.set(n,n)),n}else{if(t===null&&(e==="float"||e==="boolean")||e&&e!=="shader"&&e!=="string")return T(Un(s,t));if(e==="shader")return $(s)}return s},Ic=function(s,t=null){for(const e in s)s[e]=T(s[e],t);return s},Oc=function(s,t=null){const e=s.length;for(let n=0;n<e;n++)s[n]=T(s[n],t);return s},kc=function(s,t=null,e=null,n=null){const r=i=>T(n!==null?Object.assign(i,n):i);return t===null?(...i)=>r(new s(...de(i))):e!==null?(e=T(e),(...i)=>r(new s(t,...de(i),e))):(...i)=>r(new s(t,...de(i)))},Dc=function(s,...t){return T(new s(...de(t)))};class Lc extends b{constructor(t,e){super(),this.shaderNode=t,this.inputNodes=e}getNodeType(t){return this.shaderNode.nodeType||this.getOutputNode(t).getNodeType(t)}call(t){const{shaderNode:e,inputNodes:n}=this,r=t.getNodeProperties(e);if(r.onceOutput)return r.onceOutput;let i=null;if(e.layout){let o=er.get(t.constructor);o===void 0&&(o=new WeakMap,er.set(t.constructor,o));let a=o.get(e);a===void 0&&(a=T(t.buildFunctionNode(e)),o.set(e,a)),t.currentFunctionNode!==null&&t.currentFunctionNode.includes.push(a),i=T(a.call(n))}else{const o=e.jsFunc,a=n!==null?o(n,t):o(t);i=T(a)}return e.once&&(r.onceOutput=i),i}getOutputNode(t){const e=t.getNodeProperties(this);return e.outputNode===null&&(e.outputNode=this.setupOutput(t)),e.outputNode}setup(t){return this.getOutputNode(t)}setupOutput(t){return t.addStack(),t.stack.outputNode=this.call(t),t.removeStack()}generate(t,e){return this.getOutputNode(t).build(t,e)}}class Bc extends b{constructor(t,e){super(e),this.jsFunc=t,this.layout=null,this.global=!0,this.once=!1}setLayout(t){return this.layout=t,this}call(t=null){return un(t),T(new Lc(this,t))}setup(){return this.call()}}const Pc=[!1,!0],Vc=[0,1,2,3],Uc=[-1,-2],ei=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],rs=new Map;for(const s of Pc)rs.set(s,new Ft(s));const is=new Map;for(const s of Vc)is.set(s,new Ft(s,"uint"));const os=new Map([...is].map(s=>new Ft(s.value,"int")));for(const s of Uc)os.set(s,new Ft(s,"int"));const an=new Map([...os].map(s=>new Ft(s.value)));for(const s of ei)an.set(s,new Ft(s));for(const s of ei)an.set(-s,new Ft(-s));const hn={bool:rs,uint:is,ints:os,float:an},nr=new Map([...rs,...an]),Un=(s,t)=>nr.has(s)?nr.get(s):s.isNode===!0?s:new Ft(s,t),$c=s=>{try{return s.getNodeType()}catch{return}},U=function(s,t=null){return(...e)=>{if((e.length===0||!["bool","float","int","uint"].includes(s)&&e.every(r=>typeof r!="object"))&&(e=[Kr(s,...e)]),e.length===1&&t!==null&&t.has(e[0]))return T(t.get(e[0]));if(e.length===1){const r=Un(e[0],s);return $c(r)===s?T(r):T(new Jr(r,s))}const n=e.map(r=>Un(r));return T(new vc(n,s))}},Hc=s=>s!=null?s.nodeType||s.convertTo||(typeof s=="string"?s:null):null;function Gc(s,t){return new Proxy(new Bc(s,t),ti)}const T=(s,t=null)=>bc(s,t),un=(s,t=null)=>new Ic(s,t),de=(s,t=null)=>new Oc(s,t),N=(...s)=>new kc(...s),S=(...s)=>new Dc(...s),$=(s,t)=>{const e=new Gc(s,t),n=(...r)=>{let i;return un(r),r[0]&&r[0].isNode?i=[...r]:i=r[0],e.call(i)};return n.shaderNode=e,n.setLayout=r=>(e.setLayout(r),n),n.once=()=>(e.once=!0,n),n};m("toGlobal",s=>(s.global=!0,s));const Xc=(...s)=>Qr.If(...s);function Yc(s){return s}m("append",Yc);const qc=new U("color"),Et=new U("float",hn.float),ni=new U("int",hn.ints),Zc=new U("uint",hn.uint),Wc=new U("bool",hn.bool),Te=new U("vec2"),Kc=new U("ivec2"),Jc=new U("uvec2"),Qc=new U("bvec2"),O=new U("vec3"),jc=new U("ivec3"),tl=new U("uvec3"),el=new U("bvec3"),vt=new U("vec4"),nl=new U("ivec4"),sl=new U("uvec4"),rl=new U("bvec4"),si=new U("mat2"),_e=new U("mat3"),il=new U("mat4");m("toColor",qc);m("toFloat",Et);m("toInt",ni);m("toUint",Zc);m("toBool",Wc);m("toVec2",Te);m("toIVec2",Kc);m("toUVec2",Jc);m("toBVec2",Qc);m("toVec3",O);m("toIVec3",jc);m("toUVec3",tl);m("toBVec3",el);m("toVec4",vt);m("toIVec4",nl);m("toUVec4",sl);m("toBVec4",rl);m("toMat2",si);m("toMat3",_e);m("toMat4",il);const ol=N(we),al=(s,t)=>T(new Jr(T(s),t));m("element",ol);m("convert",al);class hl extends rt{static get type(){return"AssignNode"}constructor(t,e){super(),this.targetNode=t,this.sourceNode=e}hasDependencies(){return!1}getNodeType(t,e){return e!=="void"?this.targetNode.getNodeType(t):"void"}needsSplitAssign(t){const{targetNode:e}=this;if(t.isAvailable("swizzleAssign")===!1&&e.isSplitNode&&e.components.length>1){const n=t.getTypeLength(e.node.getNodeType(t));return Ne.join("").slice(0,n)!==e.components}return!1}generate(t,e){const{targetNode:n,sourceNode:r}=this,i=this.needsSplitAssign(t),o=n.getNodeType(t),a=n.context({assign:!0}).build(t),h=r.build(t,o),u=r.getNodeType(t),c=t.getDataFromNode(this);let l;if(c.initialized===!0)e!=="void"&&(l=a);else if(i){const f=t.getVarFromNode(this,null,o),d=t.getPropertyName(f);t.addLineFlowCode(`${d} = ${h}`,this);const g=n.node.context({assign:!0}).build(t);for(let x=0;x<n.components.length;x++){const w=n.components[x];t.addLineFlowCode(`${g}.${w} = ${d}[ ${x} ]`,this)}e!=="void"&&(l=a)}else l=`${a} = ${h}`,(e==="void"||u==="void")&&(t.addLineFlowCode(l,this),e!=="void"&&(l=a));return c.initialized=!0,t.format(l,o,e)}}const ul=N(hl);m("assign",ul);class ri extends b{static get type(){return"UniformGroupNode"}constructor(t,e=!1,n=1){super("string"),this.name=t,this.shared=e,this.order=n,this.isUniformGroup=!0}serialize(t){super.serialize(t),t.name=this.name,t.version=this.version,t.shared=this.shared}deserialize(t){super.deserialize(t),this.name=t.name,this.version=t.version,this.shared=t.shared}}const cl=s=>new ri(s),ll=(s,t=0)=>new ri(s,!0,t),Me=ll("render"),fl=cl("object");class Se extends ss{static get type(){return"UniformNode"}constructor(t,e=null){super(t,e),this.isUniformNode=!0,this.name="",this.groupNode=fl}label(t){return this.name=t,this}setGroup(t){return this.groupNode=t,this}getGroup(){return this.groupNode}getUniformHash(t){return this.getHash(t)}onUpdate(t,e){const n=this.getSelf();return t=t.bind(n),super.onUpdate(r=>{const i=t(r,n);i!==void 0&&(this.value=i)},e)}generate(t,e){const n=this.getNodeType(t),r=this.getUniformHash(t);let i=t.getNodeFromHash(r);i===void 0&&(t.setHashNode(this,r),i=this);const o=i.getInputType(t),a=t.getUniformFromNode(i,o,t.shaderStage,this.name||t.context.label),h=t.getPropertyName(a);return t.context.label!==void 0&&delete t.context.label,t.format(h,n,e)}}const st=(s,t)=>{const e=Hc(t||s),n=s&&s.isNode===!0?s.node&&s.node.value||s.value:s;return T(new Se(n,e))};class ii extends b{static get type(){return"PropertyNode"}constructor(t,e=null,n=!1){super(t),this.name=e,this.varying=n,this.isPropertyNode=!0}getHash(t){return this.name||super.getHash(t)}isGlobal(){return!0}generate(t){let e;return this.varying===!0?(e=t.getVaryingFromNode(this,this.name),e.needsInterpolation=!0):e=t.getVarFromNode(this,this.name),t.getPropertyName(e)}}const dl=(s,t)=>T(new ii(s,t)),sr=S(ii,"vec4","Output");class pl extends rt{static get type(){return"FunctionCallNode"}constructor(t=null,e={}){super(),this.functionNode=t,this.parameters=e}setParameters(t){return this.parameters=t,this}getParameters(){return this.parameters}getNodeType(t){return this.functionNode.getNodeType(t)}generate(t){const e=[],n=this.functionNode,r=n.getInputs(t),i=this.parameters,o=(h,u)=>{const c=u.type,l=c==="pointer";let f;return l?f="&"+h.build(t):f=h.build(t,c),f};if(Array.isArray(i))for(let h=0;h<i.length;h++)e.push(o(i[h],r[h]));else for(const h of r){const u=i[h.name];if(u!==void 0)e.push(o(u,h));else throw new Error(`FunctionCallNode: Input '${h.name}' not found in FunctionNode.`)}return`${n.build(t,"property")}( ${e.join(", ")} )`}}const gl=(s,...t)=>(t=t.length>1||t[0]&&t[0].isNode===!0?de(t):un(t[0]),T(new pl(T(s),t)));m("call",gl);class B extends rt{static get type(){return"OperatorNode"}constructor(t,e,n,...r){if(super(),r.length>0){let i=new B(t,e,n);for(let o=0;o<r.length-1;o++)i=new B(t,i,r[o]);e=i,n=r[r.length-1]}this.op=t,this.aNode=e,this.bNode=n}getNodeType(t,e){const n=this.op,r=this.aNode,i=this.bNode,o=r.getNodeType(t),a=typeof i<"u"?i.getNodeType(t):null;if(o==="void"||a==="void")return"void";if(n==="%")return o;if(n==="~"||n==="&"||n==="|"||n==="^"||n===">>"||n==="<<")return t.getIntegerType(o);if(n==="!"||n==="=="||n==="&&"||n==="||"||n==="^^")return"bool";if(n==="<"||n===">"||n==="<="||n===">="){const h=e?t.getTypeLength(e):Math.max(t.getTypeLength(o),t.getTypeLength(a));return h>1?`bvec${h}`:"bool"}else return o==="float"&&t.isMatrix(a)?a:t.isMatrix(o)&&t.isVector(a)?t.getVectorFromMatrix(o):t.isVector(o)&&t.isMatrix(a)?t.getVectorFromMatrix(a):t.getTypeLength(a)>t.getTypeLength(o)?a:o}generate(t,e){const n=this.op,r=this.aNode,i=this.bNode,o=this.getNodeType(t,e);let a=null,h=null;o!=="void"?(a=r.getNodeType(t),h=typeof i<"u"?i.getNodeType(t):null,n==="<"||n===">"||n==="<="||n===">="||n==="=="?t.isVector(a)?h=a:a!==h&&(a=h="float"):n===">>"||n==="<<"?(a=o,h=t.changeComponentType(h,"uint")):t.isMatrix(a)&&t.isVector(h)?h=t.getVectorFromMatrix(a):t.isVector(a)&&t.isMatrix(h)?a=t.getVectorFromMatrix(h):a=h=o):a=h=o;const u=r.build(t,a),c=typeof i<"u"?i.build(t,h):null,l=t.getTypeLength(e),f=t.getFunctionOperator(n);if(e!=="void")return n==="<"&&l>1?t.useComparisonMethod?t.format(`${t.getMethod("lessThan",e)}( ${u}, ${c} )`,o,e):t.format(`( ${u} < ${c} )`,o,e):n==="<="&&l>1?t.useComparisonMethod?t.format(`${t.getMethod("lessThanEqual",e)}( ${u}, ${c} )`,o,e):t.format(`( ${u} <= ${c} )`,o,e):n===">"&&l>1?t.useComparisonMethod?t.format(`${t.getMethod("greaterThan",e)}( ${u}, ${c} )`,o,e):t.format(`( ${u} > ${c} )`,o,e):n===">="&&l>1?t.useComparisonMethod?t.format(`${t.getMethod("greaterThanEqual",e)}( ${u}, ${c} )`,o,e):t.format(`( ${u} >= ${c} )`,o,e):n==="!"||n==="~"?t.format(`(${n}${u})`,a,e):f?t.format(`${f}( ${u}, ${c} )`,o,e):t.format(`( ${u} ${n} ${c} )`,o,e);if(a!=="void")return f?t.format(`${f}( ${u}, ${c} )`,o,e):t.format(`${u} ${n} ${c}`,o,e)}serialize(t){super.serialize(t),t.op=this.op}deserialize(t){super.deserialize(t),this.op=t.op}}const oi=N(B,"+"),$n=N(B,"-"),as=N(B,"*"),ai=N(B,"/"),hi=N(B,"%"),yl=N(B,"=="),ml=N(B,"!="),xl=N(B,"<"),Nl=N(B,">"),wl=N(B,"<="),Tl=N(B,">="),_l=N(B,"&&"),Ml=N(B,"||"),Sl=N(B,"!"),Cl=N(B,"^^"),Al=N(B,"&"),El=N(B,"~"),vl=N(B,"|"),zl=N(B,"^"),Fl=N(B,"<<"),Rl=N(B,">>");m("add",oi);m("sub",$n);m("mul",as);m("div",ai);m("modInt",hi);m("equal",yl);m("notEqual",ml);m("lessThan",xl);m("greaterThan",Nl);m("lessThanEqual",wl);m("greaterThanEqual",Tl);m("and",_l);m("or",Ml);m("not",Sl);m("xor",Cl);m("bitAnd",Al);m("bitNot",El);m("bitOr",vl);m("bitXor",zl);m("shiftLeft",Fl);m("shiftRight",Rl);const bl=(...s)=>(console.warn("TSL.OperatorNode: .remainder() has been renamed to .modInt()."),hi(...s));m("remainder",bl);class p extends rt{static get type(){return"MathNode"}constructor(t,e,n=null,r=null){super(),this.method=t,this.aNode=e,this.bNode=n,this.cNode=r}getInputType(t){const e=this.aNode.getNodeType(t),n=this.bNode?this.bNode.getNodeType(t):null,r=this.cNode?this.cNode.getNodeType(t):null,i=t.isMatrix(e)?0:t.getTypeLength(e),o=t.isMatrix(n)?0:t.getTypeLength(n),a=t.isMatrix(r)?0:t.getTypeLength(r);return i>o&&i>a?e:o>a?n:a>i?r:e}getNodeType(t){const e=this.method;return e===p.LENGTH||e===p.DISTANCE||e===p.DOT?"float":e===p.CROSS?"vec3":e===p.ALL?"bool":e===p.EQUALS?t.changeComponentType(this.aNode.getNodeType(t),"bool"):e===p.MOD?this.aNode.getNodeType(t):this.getInputType(t)}generate(t,e){let n=this.method;const r=this.getNodeType(t),i=this.getInputType(t),o=this.aNode,a=this.bNode,h=this.cNode,u=t.renderer.coordinateSystem;if(n===p.TRANSFORM_DIRECTION){let c=o,l=a;t.isMatrix(c.getNodeType(t))?l=vt(O(l),0):c=vt(O(c),0);const f=as(c,l).xyz;return ui(f).build(t,e)}else{if(n===p.NEGATE)return t.format("( - "+o.build(t,i)+" )",r,e);if(n===p.ONE_MINUS)return $n(1,o).build(t,e);if(n===p.RECIPROCAL)return ai(1,o).build(t,e);if(n===p.DIFFERENCE)return hs($n(o,a)).build(t,e);{const c=[];return n===p.CROSS||n===p.MOD?c.push(o.build(t,r),a.build(t,r)):u===Bt&&n===p.STEP?c.push(o.build(t,t.getTypeLength(o.getNodeType(t))===1?"float":i),a.build(t,i)):u===Bt&&(n===p.MIN||n===p.MAX)||n===p.MOD?c.push(o.build(t,i),a.build(t,t.getTypeLength(a.getNodeType(t))===1?"float":i)):n===p.REFRACT?c.push(o.build(t,i),a.build(t,i),h.build(t,"float")):n===p.MIX?c.push(o.build(t,i),a.build(t,i),h.build(t,t.getTypeLength(h.getNodeType(t))===1?"float":i)):(u===tn&&n===p.ATAN&&a!==null&&(n="atan2"),c.push(o.build(t,i)),a!==null&&c.push(a.build(t,i)),h!==null&&c.push(h.build(t,i))),t.format(`${t.getMethod(n,r)}( ${c.join(", ")} )`,r,e)}}}serialize(t){super.serialize(t),t.method=this.method}deserialize(t){super.deserialize(t),this.method=t.method}}p.ALL="all";p.ANY="any";p.RADIANS="radians";p.DEGREES="degrees";p.EXP="exp";p.EXP2="exp2";p.LOG="log";p.LOG2="log2";p.SQRT="sqrt";p.INVERSE_SQRT="inversesqrt";p.FLOOR="floor";p.CEIL="ceil";p.NORMALIZE="normalize";p.FRACT="fract";p.SIN="sin";p.COS="cos";p.TAN="tan";p.ASIN="asin";p.ACOS="acos";p.ATAN="atan";p.ABS="abs";p.SIGN="sign";p.LENGTH="length";p.NEGATE="negate";p.ONE_MINUS="oneMinus";p.DFDX="dFdx";p.DFDY="dFdy";p.ROUND="round";p.RECIPROCAL="reciprocal";p.TRUNC="trunc";p.FWIDTH="fwidth";p.TRANSPOSE="transpose";p.BITCAST="bitcast";p.EQUALS="equals";p.MIN="min";p.MAX="max";p.MOD="mod";p.STEP="step";p.REFLECT="reflect";p.DISTANCE="distance";p.DIFFERENCE="difference";p.DOT="dot";p.CROSS="cross";p.POW="pow";p.TRANSFORM_DIRECTION="transformDirection";p.MIX="mix";p.CLAMP="clamp";p.REFRACT="refract";p.SMOOTHSTEP="smoothstep";p.FACEFORWARD="faceforward";const Il=Et(Math.PI),Ol=N(p,p.ALL),kl=N(p,p.ANY),Dl=N(p,p.RADIANS),Ll=N(p,p.DEGREES),Bl=N(p,p.EXP),Pl=N(p,p.EXP2),Vl=N(p,p.LOG),Ul=N(p,p.LOG2),$l=N(p,p.SQRT),Hl=N(p,p.INVERSE_SQRT),Gl=N(p,p.FLOOR),Xl=N(p,p.CEIL),ui=N(p,p.NORMALIZE),ci=N(p,p.FRACT),li=N(p,p.SIN),Yl=N(p,p.COS),ql=N(p,p.TAN),Zl=N(p,p.ASIN),Wl=N(p,p.ACOS),fi=N(p,p.ATAN),hs=N(p,p.ABS),di=N(p,p.SIGN),Kl=N(p,p.LENGTH),Jl=N(p,p.NEGATE),Ql=N(p,p.ONE_MINUS),jl=N(p,p.DFDX),tf=N(p,p.DFDY),ef=N(p,p.ROUND),nf=N(p,p.RECIPROCAL),sf=N(p,p.TRUNC),rf=N(p,p.FWIDTH),of=N(p,p.TRANSPOSE);p.BITCAST;const af=N(p,p.EQUALS),hf=N(p,p.MIN),uf=N(p,p.MAX),pi=N(p,p.MOD),cf=N(p,p.STEP),lf=N(p,p.REFLECT),ff=N(p,p.DISTANCE),df=N(p,p.DIFFERENCE),us=N(p,p.DOT),pf=N(p,p.CROSS),gi=N(p,p.POW),gf=N(p,p.POW,2),yf=N(p,p.POW,3),mf=N(p,p.POW,4),xf=N(p,p.TRANSFORM_DIRECTION),Nf=s=>as(di(s),gi(hs(s),1/3)),wf=s=>us(s,s),cs=N(p,p.MIX),yi=(s,t=0,e=1)=>T(new p(p.CLAMP,T(s),T(t),T(e))),Tf=s=>yi(s),_f=N(p,p.REFRACT),mi=N(p,p.SMOOTHSTEP),Mf=N(p,p.FACEFORWARD),Sf=$(([s])=>{const n=43758.5453,r=us(s.xy,Te(12.9898,78.233)),i=pi(r,Il);return ci(li(i).mul(n))}),Cf=(s,t,e)=>cs(t,e,s),Af=(s,t,e)=>mi(t,e,s),Ef=(s,t)=>(console.warn('THREE.TSL: "atan2" is overloaded. Use "atan" instead.'),fi(s,t));m("all",Ol);m("any",kl);m("equals",af);m("radians",Dl);m("degrees",Ll);m("exp",Bl);m("exp2",Pl);m("log",Vl);m("log2",Ul);m("sqrt",$l);m("inverseSqrt",Hl);m("floor",Gl);m("ceil",Xl);m("normalize",ui);m("fract",ci);m("sin",li);m("cos",Yl);m("tan",ql);m("asin",Zl);m("acos",Wl);m("atan",fi);m("abs",hs);m("sign",di);m("length",Kl);m("lengthSq",wf);m("negate",Jl);m("oneMinus",Ql);m("dFdx",jl);m("dFdy",tf);m("round",ef);m("reciprocal",nf);m("trunc",sf);m("fwidth",rf);m("atan2",Ef);m("min",hf);m("max",uf);m("mod",pi);m("step",cf);m("reflect",lf);m("distance",ff);m("dot",us);m("cross",pf);m("pow",gi);m("pow2",gf);m("pow3",yf);m("pow4",mf);m("transformDirection",xf);m("mix",Cf);m("clamp",yi);m("refract",_f);m("smoothstep",Af);m("faceForward",Mf);m("difference",df);m("saturate",Tf);m("cbrt",Nf);m("transpose",of);m("rand",Sf);class vf extends b{static get type(){return"ConditionalNode"}constructor(t,e,n=null){super(),this.condNode=t,this.ifNode=e,this.elseNode=n}getNodeType(t){const{ifNode:e,elseNode:n}=t.getNodeProperties(this);if(e===void 0)return this.setup(t),this.getNodeType(t);const r=e.getNodeType(t);if(n!==null){const i=n.getNodeType(t);if(t.getTypeLength(i)>t.getTypeLength(r))return i}return r}setup(t){const e=this.condNode.cache(),n=this.ifNode.cache(),r=this.elseNode?this.elseNode.cache():null,i=t.context.nodeBlock;t.getDataFromNode(n).parentNodeBlock=i,r!==null&&(t.getDataFromNode(r).parentNodeBlock=i);const o=t.getNodeProperties(this);o.condNode=e,o.ifNode=n.context({nodeBlock:n}),o.elseNode=r?r.context({nodeBlock:r}):null}generate(t,e){const n=this.getNodeType(t),r=t.getDataFromNode(this);if(r.nodeProperty!==void 0)return r.nodeProperty;const{condNode:i,ifNode:o,elseNode:a}=t.getNodeProperties(this),h=e!=="void",u=h?dl(n).build(t):"";r.nodeProperty=u;const c=i.build(t,"bool");t.addFlowCode(`
${t.tab}if ( ${c} ) {

`).addFlowTab();let l=o.build(t,n);if(l&&(h?l=u+" = "+l+";":l="return "+l+";"),t.removeFlowTab().addFlowCode(t.tab+"	"+l+`

`+t.tab+"}"),a!==null){t.addFlowCode(` else {

`).addFlowTab();let f=a.build(t,n);f&&(h?f=u+" = "+f+";":f="return "+f+";"),t.removeFlowTab().addFlowCode(t.tab+"	"+f+`

`+t.tab+`}

`)}else t.addFlowCode(`

`);return t.format(u,n,e)}}const ls=N(vf);m("select",ls);const zf=(...s)=>(console.warn("TSL.ConditionalNode: cond() has been renamed to select()."),ls(...s));m("cond",zf);class Ff extends b{static get type(){return"ContextNode"}constructor(t,e={}){super(),this.isContextNode=!0,this.node=t,this.value=e}getScope(){return this.node.getScope()}getNodeType(t){return this.node.getNodeType(t)}analyze(t){this.node.build(t)}setup(t){const e=t.getContext();t.setContext({...t.context,...this.value});const n=this.node.build(t);return t.setContext(e),n}generate(t,e){const n=t.getContext();t.setContext({...t.context,...this.value});const r=this.node.build(t,e);return t.setContext(n),r}}const xi=N(Ff),Rf=(s,t)=>xi(s,{label:t});m("context",xi);m("label",Rf);class bf extends b{static get type(){return"VarNode"}constructor(t,e=null){super(),this.node=t,this.name=e,this.global=!0,this.isVarNode=!0}getHash(t){return this.name||super.getHash(t)}getNodeType(t){return this.node.getNodeType(t)}generate(t){const{node:e,name:n}=this,r=t.getVarFromNode(this,n,t.getVectorType(this.getNodeType(t))),i=t.getPropertyName(r),o=e.build(t,r.type);return t.addLineFlowCode(`${i} = ${o}`,this),i}}const Ni=N(bf);m("toVar",(...s)=>Ni(...s).append());const If=s=>(console.warn('TSL: "temp" is deprecated. Use ".toVar()" instead.'),Ni(s));m("temp",If);class Of extends b{static get type(){return"VaryingNode"}constructor(t,e=null){super(),this.node=t,this.name=e,this.isVaryingNode=!0}isGlobal(){return!0}getHash(t){return this.name||super.getHash(t)}getNodeType(t){return this.node.getNodeType(t)}setupVarying(t){const e=t.getNodeProperties(this);let n=e.varying;if(n===void 0){const r=this.name,i=this.getNodeType(t);e.varying=n=t.getVaryingFromNode(this,r,i),e.node=this.node}return n.needsInterpolation||(n.needsInterpolation=t.shaderStage==="fragment"),n}setup(t){this.setupVarying(t)}analyze(t){return this.setupVarying(t),this.node.analyze(t)}generate(t){const e=t.getNodeProperties(this),n=this.setupVarying(t),r=t.shaderStage==="fragment"&&e.reassignPosition===!0&&t.context.needsPositionReassign;if(e.propertyName===void 0||r){const i=this.getNodeType(t),o=t.getPropertyName(n,$s.VERTEX);t.flowNodeFromShaderStage($s.VERTEX,this.node,i,o),e.propertyName=o,r?e.reassignPosition=!1:e.reassignPosition===void 0&&t.context.isPositionNodeInput&&(e.reassignPosition=!0)}return t.getPropertyName(n)}}const $t=N(Of),kf=s=>$t(s);m("varying",$t);m("vertexStage",kf);const Df=$(([s])=>{const t=s.mul(.9478672986).add(.0521327014).pow(2.4),e=s.mul(.0773993808),n=s.lessThanEqual(.04045);return cs(t,e,n)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),Lf=$(([s])=>{const t=s.pow(.41666).mul(1.055).sub(.055),e=s.mul(12.92),n=s.lessThanEqual(.0031308);return cs(t,e,n)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),Ce="WorkingColorSpace",fs="OutputColorSpace";class cn extends rt{static get type(){return"ColorSpaceNode"}constructor(t,e,n){super("vec4"),this.colorNode=t,this.source=e,this.target=n}resolveColorSpace(t,e){return e===Ce?H.workingColorSpace:e===fs?t.context.outputColorSpace||t.renderer.outputColorSpace:e}setup(t){const{colorNode:e}=this,n=this.resolveColorSpace(t,this.source),r=this.resolveColorSpace(t,this.target);let i=e;return H.enabled===!1||n===r||!n||!r||(H.getTransfer(n)===fe&&(i=vt(Df(i.rgb),i.a)),H.getPrimaries(n)!==H.getPrimaries(r)&&(i=vt(_e(H._getMatrix(new wt,n,r)).mul(i.rgb),i.a)),H.getTransfer(r)===fe&&(i=vt(Lf(i.rgb),i.a))),i}}const Bf=s=>T(new cn(T(s),Ce,fs)),Pf=s=>T(new cn(T(s),fs,Ce)),Vf=(s,t)=>T(new cn(T(s),Ce,t)),wi=(s,t)=>T(new cn(T(s),t,Ce));m("toOutputColorSpace",Bf);m("toWorkingColorSpace",Pf);m("workingToColorSpace",Vf);m("colorSpaceToWorking",wi);let Uf=class extends we{static get type(){return"ReferenceElementNode"}constructor(t,e){super(t,e),this.referenceNode=t,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(t){const e=super.generate(t),n=this.referenceNode.getNodeType(),r=this.getNodeType();return t.format(e,n,r)}};class $f extends b{static get type(){return"ReferenceBaseNode"}constructor(t,e,n=null,r=null){super(),this.property=t,this.uniformType=e,this.object=n,this.count=r,this.properties=t.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=G.OBJECT}setGroup(t){return this.group=t,this}element(t){return T(new Uf(this,T(t)))}setNodeType(t){const e=st(null,t).getSelf();this.group!==null&&e.setGroup(this.group),this.node=e}getNodeType(t){return this.node===null&&(this.updateReference(t),this.updateValue()),this.node.getNodeType(t)}getValueFromReference(t=this.reference){const{properties:e}=this;let n=t[e[0]];for(let r=1;r<e.length;r++)n=n[e[r]];return n}updateReference(t){return this.reference=this.object!==null?this.object:t.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const t=this.getValueFromReference();Array.isArray(t)?this.node.array=t:this.node.value=t}}class Hf extends $f{static get type(){return"RendererReferenceNode"}constructor(t,e,n=null){super(t,e,n),this.renderer=n,this.setGroup(Me)}updateReference(t){return this.reference=this.renderer!==null?this.renderer:t.renderer,this.reference}}const Gf=(s,t,e=null)=>T(new Hf(s,t,e));class Xf extends rt{static get type(){return"ToneMappingNode"}constructor(t,e=qf,n=null){super("vec3"),this.toneMapping=t,this.exposureNode=e,this.colorNode=n}customCacheKey(){return Wr(this.toneMapping)}setup(t){const e=this.colorNode||t.context.color,n=this.toneMapping;if(n===Bn)return e;let r=null;const i=t.renderer.library.getToneMappingFunction(n);return i!==null?r=vt(i(e.rgb,this.exposureNode),e.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",n),r=e),r}}const Yf=(s,t,e)=>T(new Xf(s,T(t),T(e))),qf=Gf("toneMappingExposure","float");m("toneMapping",(s,t,e)=>Yf(t,e,s));const P=new L,ke=new ot;class Zf{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=n,this.usage=je,this.updateRanges=[],this.gpuType=yc,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,n=this.count;e<n;e++)ke.fromBufferAttribute(this,e),ke.applyMatrix3(t),this.setXY(e,ke.x,ke.y);else if(this.itemSize===3)for(let e=0,n=this.count;e<n;e++)P.fromBufferAttribute(this,e),P.applyMatrix3(t),this.setXYZ(e,P.x,P.y,P.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)P.fromBufferAttribute(this,e),P.applyMatrix4(t),this.setXYZ(e,P.x,P.y,P.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)P.fromBufferAttribute(this,e),P.applyNormalMatrix(t),this.setXYZ(e,P.x,P.y,P.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)P.fromBufferAttribute(this,e),P.transformDirection(t),this.setXYZ(e,P.x,P.y,P.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=ft(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=I(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=ft(e,this.array)),e}setX(t,e){return this.normalized&&(e=I(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=ft(e,this.array)),e}setY(t,e){return this.normalized&&(e=I(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=ft(e,this.array)),e}setZ(t,e){return this.normalized&&(e=I(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=ft(e,this.array)),e}setW(t,e){return this.normalized&&(e=I(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=I(e,this.array),n=I(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,r){return t*=this.itemSize,this.normalized&&(e=I(e,this.array),n=I(n,this.array),r=I(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t*=this.itemSize,this.normalized&&(e=I(e,this.array),n=I(n,this.array),r=I(r,this.array),i=I(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==je&&(t.usage=this.usage),t}}const K=new L;class ds{constructor(t,e,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)K.fromBufferAttribute(this,e),K.applyMatrix4(t),this.setXYZ(e,K.x,K.y,K.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)K.fromBufferAttribute(this,e),K.applyNormalMatrix(t),this.setXYZ(e,K.x,K.y,K.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)K.fromBufferAttribute(this,e),K.transformDirection(t),this.setXYZ(e,K.x,K.y,K.z);return this}getComponent(t,e){let n=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(n=ft(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=I(n,this.array)),this.data.array[t*this.data.stride+this.offset+e]=n,this}setX(t,e){return this.normalized&&(e=I(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=I(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=I(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=I(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=ft(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=ft(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=ft(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=ft(e,this.array)),e}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=I(e,this.array),n=I(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=I(e,this.array),n=I(n,this.array),r=I(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=I(e,this.array),n=I(n,this.array),r=I(r,this.array),i=I(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)e.push(this.data.array[r+i])}return new Zf(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new ds(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)e.push(this.data.array[r+i])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Wf{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=je,this.updateRanges=[],this.version=0,this.uuid=Zt()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Zt()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Zt()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}class Kf extends ss{static get type(){return"BufferAttributeNode"}constructor(t,e=null,n=0,r=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferStride=n,this.bufferOffset=r,this.usage=je,this.instanced=!1,this.attribute=null,this.global=!0,t&&t.isBufferAttribute===!0&&(this.attribute=t,this.usage=t.usage,this.instanced=t.isInstancedBufferAttribute)}getHash(t){if(this.bufferStride===0&&this.bufferOffset===0){let e=t.globalCache.getData(this.value);return e===void 0&&(e={node:this},t.globalCache.setData(this.value,e)),e.node.uuid}return this.uuid}getNodeType(t){return this.bufferType===null&&(this.bufferType=t.getTypeFromAttribute(this.attribute)),this.bufferType}setup(t){if(this.attribute!==null)return;const e=this.getNodeType(t),n=this.value,r=t.getTypeLength(e),i=this.bufferStride||r,o=this.bufferOffset,a=n.isInterleavedBuffer===!0?n:new Wf(n,i),h=new ds(a,r,o);a.setUsage(this.usage),this.attribute=h,this.attribute.isInstancedBufferAttribute=this.instanced}generate(t){const e=this.getNodeType(t),n=t.getBufferAttributeFromNode(this,e),r=t.getPropertyName(n);let i=null;return t.shaderStage==="vertex"||t.shaderStage==="compute"?(this.name=r,i=r):i=$t(this).build(t,e),i}getInputType(){return"bufferAttribute"}setUsage(t){return this.usage=t,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=t),this}setInstanced(t){return this.instanced=t,this}}const Jf=(s,t=null,e=0,n=0)=>T(new Kf(s,t,e,n));m("toAttribute",s=>Jf(s.value));class Qf extends b{static get type(){return"ComputeNode"}constructor(t,e,n=[64]){super("void"),this.isComputeNode=!0,this.computeNode=t,this.count=e,this.workgroupSize=n,this.dispatchCount=0,this.version=1,this.name="",this.updateBeforeType=G.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}label(t){return this.name=t,this}updateDispatchCount(){const{count:t,workgroupSize:e}=this;let n=e[0];for(let r=1;r<e.length;r++)n*=e[r];this.dispatchCount=Math.ceil(t/n)}onInit(t){return this.onInitFunction=t,this}updateBefore({renderer:t}){t.compute(this)}generate(t){const{shaderStage:e}=t;if(e==="compute"){const n=this.computeNode.build(t,"void");n!==""&&t.addLineFlowCode(n,this)}}}const jf=(s,t,e)=>T(new Qf(T(s),t,e));m("compute",jf);class td extends b{static get type(){return"CacheNode"}constructor(t,e=!0){super(),this.node=t,this.parent=e,this.isCacheNode=!0}getNodeType(t){const e=t.getCache(),n=t.getCacheFromNode(this,this.parent);t.setCache(n);const r=this.node.getNodeType(t);return t.setCache(e),r}build(t,...e){const n=t.getCache(),r=t.getCacheFromNode(this,this.parent);t.setCache(r);const i=this.node.build(t,...e);return t.setCache(n),i}}const ed=(s,t)=>T(new td(T(s),t));m("cache",ed);class nd extends b{static get type(){return"BypassNode"}constructor(t,e){super(),this.isBypassNode=!0,this.outputNode=t,this.callNode=e}getNodeType(t){return this.outputNode.getNodeType(t)}generate(t){const e=this.callNode.build(t,"void");return e!==""&&t.addLineFlowCode(e,this),this.outputNode.build(t)}}const sd=N(nd);m("bypass",sd);class Ti extends b{static get type(){return"RemapNode"}constructor(t,e,n,r=Et(0),i=Et(1)){super(),this.node=t,this.inLowNode=e,this.inHighNode=n,this.outLowNode=r,this.outHighNode=i,this.doClamp=!0}setup(){const{node:t,inLowNode:e,inHighNode:n,outLowNode:r,outHighNode:i,doClamp:o}=this;let a=t.sub(e).div(n.sub(e));return o===!0&&(a=a.clamp()),a.mul(i.sub(r)).add(r)}}const rd=N(Ti,null,null,{doClamp:!1}),id=N(Ti);m("remap",rd);m("remapClamp",id);class od extends b{static get type(){return"ExpressionNode"}constructor(t="",e="void"){super(e),this.snippet=t}generate(t,e){const n=this.getNodeType(t),r=this.snippet;if(n==="void")t.addLineFlowCode(r,this);else return t.format(`( ${r} )`,n,e)}}const Hn=N(od),ad=s=>(s?ls(s,Hn("discard")):Hn("discard")).append();m("discard",ad);class hd extends rt{static get type(){return"RenderOutputNode"}constructor(t,e,n){super("vec4"),this.colorNode=t,this.toneMapping=e,this.outputColorSpace=n,this.isRenderOutputNode=!0}setup({context:t}){let e=this.colorNode||t.color;const n=(this.toneMapping!==null?this.toneMapping:t.toneMapping)||Bn,r=(this.outputColorSpace!==null?this.outputColorSpace:t.outputColorSpace)||Qe;return n!==Bn&&(e=e.toneMapping(n)),r!==Qe&&r!==H.workingColorSpace&&(e=e.workingToColorSpace(r)),e}}const ud=(s,t=null,e=null)=>T(new hd(T(s),t,e));m("renderOutput",ud);class cd extends b{static get type(){return"AttributeNode"}constructor(t,e=null){super(e),this.global=!0,this._attributeName=t}getHash(t){return this.getAttributeName(t)}getNodeType(t){let e=this.nodeType;if(e===null){const n=this.getAttributeName(t);if(t.hasGeometryAttribute(n)){const r=t.geometry.getAttribute(n);e=t.getTypeFromAttribute(r)}else e="float"}return e}setAttributeName(t){return this._attributeName=t,this}getAttributeName(){return this._attributeName}generate(t){const e=this.getAttributeName(t),n=this.getNodeType(t);if(t.hasGeometryAttribute(e)===!0){const i=t.geometry.getAttribute(e),o=t.getTypeFromAttribute(i),a=t.getAttribute(e,o);return t.shaderStage==="vertex"?t.format(a.name,o,n):$t(this).build(t,n)}else return console.warn(`AttributeNode: Vertex attribute "${e}" not found on geometry.`),t.generateConst(n)}serialize(t){super.serialize(t),t.global=this.global,t._attributeName=this._attributeName}deserialize(t){super.deserialize(t),this.global=t.global,this._attributeName=t._attributeName}}const ps=(s,t)=>T(new cd(s,t));class D extends b{static get type(){return"IndexNode"}constructor(t){super("uint"),this.scope=t,this.isIndexNode=!0}generate(t){const e=this.getNodeType(t),n=this.scope;let r;if(n===D.VERTEX)r=t.getVertexIndex();else if(n===D.INSTANCE)r=t.getInstanceIndex();else if(n===D.DRAW)r=t.getDrawIndex();else if(n===D.INVOCATION_LOCAL)r=t.getInvocationLocalIndex();else if(n===D.INVOCATION_SUBGROUP)r=t.getInvocationSubgroupIndex();else if(n===D.SUBGROUP)r=t.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+n);let i;return t.shaderStage==="vertex"||t.shaderStage==="compute"?i=r:i=$t(this).build(t,e),i}}D.VERTEX="vertex";D.INSTANCE="instance";D.SUBGROUP="subgroup";D.INVOCATION_LOCAL="invocationLocal";D.INVOCATION_SUBGROUP="invocationSubgroup";D.DRAW="draw";D.VERTEX;D.INSTANCE;D.SUBGROUP;D.INVOCATION_SUBGROUP;D.INVOCATION_LOCAL;D.DRAW;class R extends b{static get type(){return"Object3DNode"}constructor(t,e=null){super(),this.scope=t,this.object3d=e,this.updateType=G.OBJECT,this._uniformNode=new Se(null)}getNodeType(){const t=this.scope;if(t===R.WORLD_MATRIX)return"mat4";if(t===R.POSITION||t===R.VIEW_POSITION||t===R.DIRECTION||t===R.SCALE)return"vec3"}update(t){const e=this.object3d,n=this._uniformNode,r=this.scope;if(r===R.WORLD_MATRIX)n.value=e.matrixWorld;else if(r===R.POSITION)n.value=n.value||new L,n.value.setFromMatrixPosition(e.matrixWorld);else if(r===R.SCALE)n.value=n.value||new L,n.value.setFromMatrixScale(e.matrixWorld);else if(r===R.DIRECTION)n.value=n.value||new L,e.getWorldDirection(n.value);else if(r===R.VIEW_POSITION){const i=t.camera;n.value=n.value||new L,n.value.setFromMatrixPosition(e.matrixWorld),n.value.applyMatrix4(i.matrixWorldInverse)}}generate(t){const e=this.scope;return e===R.WORLD_MATRIX?this._uniformNode.nodeType="mat4":(e===R.POSITION||e===R.VIEW_POSITION||e===R.DIRECTION||e===R.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(t)}serialize(t){super.serialize(t),t.scope=this.scope}deserialize(t){super.deserialize(t),this.scope=t.scope}}R.WORLD_MATRIX="worldMatrix";R.POSITION="position";R.SCALE="scale";R.VIEW_POSITION="viewPosition";R.DIRECTION="direction";R.DIRECTION;R.WORLD_MATRIX;R.POSITION;R.SCALE;R.VIEW_POSITION;const ee=st("float").label("cameraNear").setGroup(Me).onRenderUpdate(({camera:s})=>s.near),ne=st("float").label("cameraFar").setGroup(Me).onRenderUpdate(({camera:s})=>s.far),ln=st("mat4").label("cameraViewMatrix").setGroup(Me).onRenderUpdate(({camera:s})=>s.matrixWorldInverse);class xt extends R{static get type(){return"ModelNode"}constructor(t){super(t)}update(t){this.object3d=t.object,super.update(t)}}xt.DIRECTION;const ld=S(xt,xt.WORLD_MATRIX);xt.POSITION;xt.SCALE;xt.VIEW_POSITION;const fd=st(new wt).onObjectUpdate(({object:s},t)=>t.value.getNormalMatrix(s.matrixWorld)),dd=$(s=>s.renderer.nodes.modelViewMatrix||pd).once()().toVar("modelViewMatrix"),pd=ln.mul(ld),yt=$(s=>s.context.setupPositionView(),"vec3").once()().varying("v_positionView").context({needsPositionReassign:!0}),_i=yt.negate().varying("v_positionViewDirection").normalize().toVar("positionViewDirection");class gd extends b{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(t){const{renderer:e,material:n}=t;return e.coordinateSystem===Bt&&n.side===lc?"false":t.getFrontFacing()}}const yd=S(gd),gs=Et(yd).mul(2).sub(1),md=ps("normal","vec3"),xd=$(s=>s.geometry.hasAttribute("normal")===!1?(console.warn('TSL.NormalNode: Vertex attribute "normal" not found on geometry.'),O(0,1,0)):md,"vec3").once()().toVar("normalLocal"),Nd=yt.dFdx().cross(yt.dFdy()).normalize().toVar("normalFlat"),jt=$(s=>{let t;return s.material.flatShading===!0?t=Nd:t=$t(Si(xd),"v_normalView").normalize(),t},"vec3").once()().toVar("normalView"),Mi=$(s=>s.context.setupNormal(),"vec3").once()().mul(gs).toVar("transformedNormalView"),Si=$(([s],t)=>{const e=t.renderer.nodes.modelNormalViewMatrix;if(e!==null)return e.transformDirection(s);const n=fd.mul(s);return ln.transformDirection(n)});class wd extends Se{static get type(){return"MaxMipLevelNode"}constructor(t){super(0),this._textureNode=t,this.updateType=G.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const t=this.texture,e=t.images,n=e&&e.length>0?e[0]&&e[0].image||e[0]:t.image;if(n&&n.width!==void 0){const{width:r,height:i}=n;this.value=Math.log2(Math.max(r,i))}}}const Td=N(wd);let se,re;class V extends b{static get type(){return"ScreenNode"}constructor(t){super(),this.scope=t,this.isViewportNode=!0}getNodeType(){return this.scope===V.VIEWPORT?"vec4":"vec2"}getUpdateType(){let t=G.NONE;return(this.scope===V.SIZE||this.scope===V.VIEWPORT)&&(t=G.RENDER),this.updateType=t,t}update({renderer:t}){const e=t.getRenderTarget();this.scope===V.VIEWPORT?e!==null?re.copy(e.viewport):(t.getViewport(re),re.multiplyScalar(t.getPixelRatio())):e!==null?(se.width=e.width,se.height=e.height):t.getDrawingBufferSize(se)}setup(){const t=this.scope;let e=null;return t===V.SIZE?e=st(se||(se=new ot)):t===V.VIEWPORT?e=st(re||(re=new Ot)):e=Te(Ci.div(rr)),e}generate(t){if(this.scope===V.COORDINATE){let e=t.getFragCoord();if(t.isFlipY()){const n=t.getNodeProperties(rr).outputNode.build(t);e=`${t.getType("vec2")}( ${e}.x, ${n}.y - ${e}.y )`}return e}return super.generate(t)}}V.COORDINATE="coordinate";V.VIEWPORT="viewport";V.SIZE="size";V.UV="uv";const ys=S(V,V.UV),rr=S(V,V.SIZE),Ci=S(V,V.COORDINATE),Ai=S(V,V.VIEWPORT);Ai.zw;Ai.xy;const ms=(s=0)=>ps("uv"+(s>0?s:""),"vec2");class _d extends b{static get type(){return"TextureSizeNode"}constructor(t,e=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=t,this.levelNode=e}generate(t,e){const n=this.textureNode.build(t,"property"),r=this.levelNode===null?"0":this.levelNode.build(t,"int");return t.format(`${t.getMethod("textureDimensions")}( ${n}, ${r} )`,this.getNodeType(t),e)}}const ir=N(_d);class fn extends Se{static get type(){return"TextureNode"}constructor(t,e=null,n=null,r=null){super(t),this.isTextureNode=!0,this.uvNode=e,this.levelNode=n,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=G.NONE,this.referenceNode=null,this._value=t,this._matrixUniform=null,this.setUpdateMatrix(e===null)}set value(t){this.referenceNode?this.referenceNode.value=t:this._value=t}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===Yr?"uvec4":this.value.type===gc?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return ms(this.value.channel)}updateReference(){return this.value}getTransformedUV(t){return this._matrixUniform===null&&(this._matrixUniform=st(this.value.matrix)),this._matrixUniform.mul(O(t,1)).xy}setUpdateMatrix(t){return this.updateMatrix=t,this.updateType=t?G.RENDER:G.NONE,this}setupUV(t,e){const n=this.value;return t.isFlipY()&&(n.image instanceof ImageBitmap&&n.flipY===!0||n.isRenderTargetTexture===!0||n.isFramebufferTexture===!0||n.isDepthTexture===!0)&&(this.sampler?e=e.flipY():e=e.setY(ni(ir(this,this.levelNode).y).sub(e.y).sub(1))),e}setup(t){const e=t.getNodeProperties(this);e.referenceNode=this.referenceNode;const n=this.value;if(!n||n.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let r=this.uvNode;(r===null||t.context.forceUVContext===!0)&&t.context.getUV&&(r=t.context.getUV(this)),r||(r=this.getDefaultUV()),this.updateMatrix===!0&&(r=this.getTransformedUV(r)),r=this.setupUV(t,r);let i=this.levelNode;i===null&&t.context.getTextureLevel&&(i=t.context.getTextureLevel(this)),e.uvNode=r,e.levelNode=i,e.biasNode=this.biasNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.depthNode=this.depthNode}generateUV(t,e){return e.build(t,this.sampler===!0?"vec2":"ivec2")}generateSnippet(t,e,n,r,i,o,a,h){const u=this.value;let c;return r?c=t.generateTextureLevel(u,e,n,r,o):i?c=t.generateTextureBias(u,e,n,i,o):h?c=t.generateTextureGrad(u,e,n,h,o):a?c=t.generateTextureCompare(u,e,n,a,o):this.sampler===!1?c=t.generateTextureLoad(u,e,n,o):c=t.generateTexture(u,e,n,o),c}generate(t,e){const n=this.value,r=t.getNodeProperties(this),i=super.generate(t,"property");if(e==="sampler")return i+"_sampler";if(t.isReference(e))return i;{const o=t.getDataFromNode(this);let a=o.propertyName;if(a===void 0){const{uvNode:c,levelNode:l,biasNode:f,compareNode:d,depthNode:g,gradNode:x}=r,w=this.generateUV(t,c),_=l?l.build(t,"float"):null,v=f?f.build(t,"float"):null,E=g?g.build(t,"int"):null,F=d?d.build(t,"float"):null,C=x?[x[0].build(t,"vec2"),x[1].build(t,"vec2")]:null,k=t.getVarFromNode(this);a=t.getPropertyName(k);const M=this.generateSnippet(t,i,w,_,v,E,F,C);t.addLineFlowCode(`${a} = ${M}`,this),o.snippet=M,o.propertyName=a}let h=a;const u=this.getNodeType(t);return t.needsToWorkingColorSpace(n)&&(h=wi(Hn(h,u),n.colorSpace).setup(t).build(t,u)),t.format(h,u,e)}}setSampler(t){return this.sampler=t,this}getSampler(){return this.sampler}uv(t){return console.warn("THREE.TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(t)}sample(t){const e=this.clone();return e.uvNode=T(t),e.referenceNode=this.getSelf(),T(e)}blur(t){const e=this.clone();return e.biasNode=T(t).mul(Td(e)),e.referenceNode=this.getSelf(),T(e)}level(t){const e=this.clone();return e.levelNode=T(t),e.referenceNode=this.getSelf(),T(e)}size(t){return ir(this,t)}bias(t){const e=this.clone();return e.biasNode=T(t),e.referenceNode=this.getSelf(),T(e)}compare(t){const e=this.clone();return e.compareNode=T(t),e.referenceNode=this.getSelf(),T(e)}grad(t,e){const n=this.clone();return n.gradNode=[T(t),T(e)],n.referenceNode=this.getSelf(),T(n)}depth(t){const e=this.clone();return e.depthNode=T(t),e.referenceNode=this.getSelf(),T(e)}serialize(t){super.serialize(t),t.value=this.value.toJSON(t.meta).uuid,t.sampler=this.sampler,t.updateMatrix=this.updateMatrix,t.updateType=this.updateType}deserialize(t){super.deserialize(t),this.value=t.meta.textures[t.value],this.sampler=t.sampler,this.updateMatrix=t.updateMatrix,this.updateType=t.updateType}update(){const t=this.value,e=this._matrixUniform;e!==null&&(e.value=t.matrix),t.matrixAutoUpdate===!0&&t.updateMatrix()}clone(){const t=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return t.sampler=this.sampler,t}}const Md=N(fn);function or(s){return document.createElementNS("http://www.w3.org/1999/xhtml",s)}let Gt;class Sd{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{Gt===void 0&&(Gt=or("canvas")),Gt.width=t.width,Gt.height=t.height;const n=Gt.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Gt}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=or("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height),i=r.data;for(let o=0;o<i.length;o++)i[o]=At(i[o]/255)*255;return n.putImageData(r,0,0),e}else if(t.data){const e=t.data.slice(0);for(let n=0;n<e.length;n++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[n]=Math.floor(At(e[n]/255)*255):e[n]=At(e[n]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let Cd=0;class Ei{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Cd++}),this.uuid=Zt(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let i;if(Array.isArray(r)){i=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?i.push(Cn(r[o].image)):i.push(Cn(r[o]))}else i=Cn(r);n.url=i}return e||(t.images[this.uuid]=n),n}}function Cn(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap?Sd.getDataURL(s):s.data?{data:Array.from(s.data),width:s.width,height:s.height,type:s.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Ad=0;class mt extends ns{constructor(t=mt.DEFAULT_IMAGE,e=mt.DEFAULT_MAPPING,n=be,r=be,i=Gr,o=Xr,a=Nc,h=pc,u=mt.DEFAULT_ANISOTROPY,c=Qe){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Ad++}),this.uuid=Zt(),this.name="",this.source=new Ei(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=o,this.anisotropy=u,this.format=a,this.internalFormat=null,this.type=h,this.offset=new ot(0,0),this.repeat=new ot(1,1),this.center=new ot(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new wt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==ts)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Gs:t.x=t.x-Math.floor(t.x);break;case be:t.x=t.x<0?0:1;break;case Xs:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Gs:t.y=t.y-Math.floor(t.y);break;case be:t.y=t.y<0?0:1;break;case Xs:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}mt.DEFAULT_IMAGE=null;mt.DEFAULT_MAPPING=ts;mt.DEFAULT_ANISOTROPY=1;class Ed extends mt{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=Je,this.minFilter=Je,this.generateMipmaps=!1,this.needsUpdate=!0}}const ie=new ot;class vd extends fn{static get type(){return"ViewportTextureNode"}constructor(t=ys,e=null,n=null){n===null&&(n=new Ed,n.minFilter=Xr),super(n,t,e),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=G.FRAME}updateBefore(t){const e=t.renderer;e.getDrawingBufferSize(ie);const n=this.value;(n.image.width!==ie.width||n.image.height!==ie.height)&&(n.image.width=ie.width,n.image.height=ie.height,n.needsUpdate=!0);const r=n.generateMipmaps;n.generateMipmaps=this.generateMipmaps,e.copyFramebufferToTexture(n),n.generateMipmaps=r}clone(){const t=new this.constructor(this.uvNode,this.levelNode,this.value);return t.generateMipmaps=this.generateMipmaps,t}}class xs extends mt{constructor(t,e,n,r,i,o,a,h,u,c=wn){if(c!==wn&&c!==Ys)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&c===wn&&(n=Yr),n===void 0&&c===Ys&&(n=xc),super(null,r,i,o,a,h,c,n,u),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=a!==void 0?a:Je,this.minFilter=h!==void 0?h:Je,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}let An=null;class zd extends vd{static get type(){return"ViewportDepthTextureNode"}constructor(t=ys,e=null){An===null&&(An=new xs),super(t,e,An)}}const Fd=N(zd);class et extends b{static get type(){return"ViewportDepthNode"}constructor(t,e=null){super("float"),this.scope=t,this.valueNode=e,this.isViewportDepthNode=!0}generate(t){const{scope:e}=this;return e===et.DEPTH_BASE?t.getFragDepth():super.generate(t)}setup({camera:t}){const{scope:e}=this,n=this.valueNode;let r=null;if(e===et.DEPTH_BASE)n!==null&&(r=zi().assign(n));else if(e===et.DEPTH)t.isPerspectiveCamera?r=Rd(yt.z,ee,ne):r=Ve(yt.z,ee,ne);else if(e===et.LINEAR_DEPTH)if(n!==null)if(t.isPerspectiveCamera){const i=vi(n,ee,ne);r=Ve(i,ee,ne)}else r=n;else r=Ve(yt.z,ee,ne);return r}}et.DEPTH_BASE="depthBase";et.DEPTH="depth";et.LINEAR_DEPTH="linearDepth";const Ve=(s,t,e)=>s.add(t).div(t.sub(e)),Rd=(s,t,e)=>t.add(s).mul(e).div(e.sub(t).mul(s)),vi=(s,t,e)=>t.mul(e).div(e.sub(t).mul(s).sub(e)),zi=N(et,et.DEPTH_BASE),bd=S(et,et.DEPTH),Id=N(et,et.LINEAR_DEPTH);Fd();bd.assign=s=>zi(s);const En=new L,Od=new L,kd=new wt;class Dd{constructor(t=new L(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const r=En.subVectors(n,e).cross(Od.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const n=t.delta(En),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:e.copy(t.start).addScaledVector(n,i)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||kd.getNormalMatrix(t),r=this.coplanarPoint(En).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const ar=new It,hr=new Zr;class dn{constructor(t=0,e=0,n=0,r=dn.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,r=this._order){return this._x=t,this._y=e,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const r=t.elements,i=r[0],o=r[4],a=r[8],h=r[1],u=r[5],c=r[9],l=r[2],f=r[6],d=r[10];switch(e){case"XYZ":this._y=Math.asin(z(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(f,u),this._z=0);break;case"YXZ":this._x=Math.asin(-z(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(h,u)):(this._y=Math.atan2(-l,i),this._z=0);break;case"ZXY":this._x=Math.asin(z(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-l,d),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(h,i));break;case"ZYX":this._y=Math.asin(-z(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(f,d),this._z=Math.atan2(h,i)):(this._x=0,this._z=Math.atan2(-o,u));break;case"YZX":this._z=Math.asin(z(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-l,i)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-z(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,n===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return ar.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ar,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return hr.setFromEuler(this),this.setFromQuaternion(hr,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}dn.DEFAULT_ORDER="XYZ";class Fi extends ns{constructor(t=1,e=1,n={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new Ot(0,0,t,e),this.scissorTest=!1,this.viewport=new Ot(0,0,t,e);const r={width:t,height:e,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Gr,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const i=new mt(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);i.flipY=!1,i.generateMipmaps=n.generateMipmaps,i.internalFormat=n.internalFormat,this.textures=[];const o=n.count;for(let a=0;a<o;a++)this.textures[a]=i.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}set depthTexture(t){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),t!==null&&(t.renderTarget=this),this._depthTexture=t}get depthTexture(){return this._depthTexture}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let r=0,i=this.textures.length;r<i;r++)this.textures[r].image.width=t,this.textures[r].image.height=e,this.textures[r].image.depth=n;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let n=0,r=t.textures.length;n<r;n++)this.textures[n]=t.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0,this.textures[n].renderTarget=this;const e=Object.assign({},t.texture.image);return this.texture.source=new Ei(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}new Dd;new L;new L;new L;new It;new L(0,0,-1);new Ot;new L;new L;new Ot;new ot;const Ld=new Fi;ys.flipX();Ld.depthTexture=new xs(1,1);const Bd=st(0).onReference(({material:s})=>s).onRenderUpdate(({material:s})=>s.refractionRatio),Pd=_i.negate().reflect(Mi),Vd=_i.negate().refract(Mi,Bd),Ud=Pd.transformDirection(ln).toVar("reflectVector"),$d=Vd.transformDirection(ln).toVar("reflectVector");class Hd extends fn{static get type(){return"CubeTextureNode"}constructor(t,e=null,n=null,r=null){super(t,e,n,r),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const t=this.value;return t.mapping===fc?Ud:t.mapping===dc?$d:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',t.mapping),O(0,0,0))}setUpdateMatrix(){}setupUV(t,e){const n=this.value;return t.renderer.coordinateSystem===tn||!n.isRenderTargetTexture?O(e.x.negate(),e.yz):e}generateUV(t,e){return e.build(t,"vec3")}}const Gd=N(Hd);class Ri extends Se{static get type(){return"BufferNode"}constructor(t,e,n=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferCount=n}getElementType(t){return this.getNodeType(t)}getInputType(){return"buffer"}}const Xd=(s,t,e)=>T(new Ri(s,t,e));class Yd extends we{static get type(){return"UniformArrayElementNode"}constructor(t,e){super(t,e),this.isArrayBufferElementNode=!0}generate(t){const e=super.generate(t),n=this.getNodeType(),r=this.node.getPaddedType();return t.format(e,r,n)}}class qd extends Ri{static get type(){return"UniformArrayNode"}constructor(t,e=null){super(null),this.array=t,this.elementType=e===null?en(t[0]):e,this.paddedType=this.getPaddedType(),this.updateType=G.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const t=this.elementType;let e="vec4";return t==="mat2"?e="mat2":/mat/.test(t)===!0?e="mat4":t.charAt(0)==="i"?e="ivec4":t.charAt(0)==="u"&&(e="uvec4"),e}update(){const{array:t,value:e}=this,n=this.elementType;if(n==="float"||n==="int"||n==="uint")for(let r=0;r<t.length;r++){const i=r*4;e[i]=t[r]}else if(n==="color")for(let r=0;r<t.length;r++){const i=r*4,o=t[r];e[i]=o.r,e[i+1]=o.g,e[i+2]=o.b||0}else if(n==="mat2")for(let r=0;r<t.length;r++){const i=r*4,o=t[r];e[i]=o.elements[0],e[i+1]=o.elements[1],e[i+2]=o.elements[2],e[i+3]=o.elements[3]}else if(n==="mat3")for(let r=0;r<t.length;r++){const i=r*16,o=t[r];e[i]=o.elements[0],e[i+1]=o.elements[1],e[i+2]=o.elements[2],e[i+4]=o.elements[3],e[i+5]=o.elements[4],e[i+6]=o.elements[5],e[i+8]=o.elements[6],e[i+9]=o.elements[7],e[i+10]=o.elements[8],e[i+15]=1}else if(n==="mat4")for(let r=0;r<t.length;r++){const i=r*16,o=t[r];for(let a=0;a<o.elements.length;a++)e[i+a]=o.elements[a]}else for(let r=0;r<t.length;r++){const i=r*4,o=t[r];e[i]=o.x,e[i+1]=o.y,e[i+2]=o.z||0,e[i+3]=o.w||0}}setup(t){const e=this.array.length,n=this.elementType;let r=Float32Array;const i=this.paddedType,o=t.getTypeLength(i);return n.charAt(0)==="i"&&(r=Int32Array),n.charAt(0)==="u"&&(r=Uint32Array),this.value=new r(e*o),this.bufferCount=e,this.bufferType=i,super.setup(t)}element(t){return T(new Yd(this,T(t)))}}const Zd=(s,t)=>T(new qd(s,t));class Wd extends we{static get type(){return"ReferenceElementNode"}constructor(t,e){super(t,e),this.referenceNode=t,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(t){const e=super.generate(t),n=this.referenceNode.getNodeType(),r=this.getNodeType();return t.format(e,n,r)}}class bi extends b{static get type(){return"ReferenceNode"}constructor(t,e,n=null,r=null){super(),this.property=t,this.uniformType=e,this.object=n,this.count=r,this.properties=t.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=G.OBJECT}element(t){return T(new Wd(this,T(t)))}setGroup(t){return this.group=t,this}label(t){return this.name=t,this}setNodeType(t){let e=null;this.count!==null?e=Xd(null,t,this.count):Array.isArray(this.getValueFromReference())?e=Zd(null,t):t==="texture"?e=Md(null):t==="cubeTexture"?e=Gd(null):e=st(null,t),this.group!==null&&e.setGroup(this.group),this.name!==null&&e.label(this.name),this.node=e.getSelf()}getNodeType(t){return this.node===null&&(this.updateReference(t),this.updateValue()),this.node.getNodeType(t)}getValueFromReference(t=this.reference){const{properties:e}=this;let n=t[e[0]];for(let r=1;r<e.length;r++)n=n[e[r]];return n}updateReference(t){return this.reference=this.object!==null?this.object:t.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const t=this.getValueFromReference();Array.isArray(t)?this.node.array=t:this.node.value=t}}const nn=(s,t,e)=>T(new bi(s,t,e));class Kd extends bi{static get type(){return"MaterialReferenceNode"}constructor(t,e,n=null){super(t,e,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(t){return this.reference=this.material!==null?this.material:t.material,this.reference}}const Jd=(s,t,e=null)=>T(new Kd(s,t,e)),Ii=$(s=>(s.geometry.hasAttribute("tangent")===!1&&s.geometry.computeTangents(),ps("tangent","vec4")))(),Qd=Ii.xyz.toVar("tangentLocal"),Oi=dd.mul(vt(Qd,0)).xyz.varying("v_tangentView").normalize().toVar("tangentView"),jd=s=>s.mul(Ii.w).xyz,tp=$t(jd(jt.cross(Oi)),"v_bitangentView").normalize().toVar("bitangentView"),ep=_e(Oi,tp,jt),np=$(s=>{const{eye_pos:t,surf_norm:e,mapN:n,uv:r}=s,i=t.dFdx(),o=t.dFdy(),a=r.dFdx(),h=r.dFdy(),u=e,c=o.cross(u),l=u.cross(i),f=c.mul(a.x).add(l.mul(h.x)),d=c.mul(a.y).add(l.mul(h.y)),g=f.dot(f).max(d.dot(d)),x=gs.mul(g.inverseSqrt());return oi(f.mul(n.x,x),d.mul(n.y,x),u.mul(n.z)).normalize()});class sp extends rt{static get type(){return"NormalMapNode"}constructor(t,e=null){super("vec3"),this.node=t,this.scaleNode=e,this.normalMapType=qs}setup(t){const{normalMapType:e,scaleNode:n}=this;let r=this.node.mul(2).sub(1);n!==null&&(r=O(r.xy.mul(n),r.z));let i=null;return e===wc?i=Si(r):e===qs&&(t.hasGeometryAttribute("tangent")===!0?i=ep.mul(r).normalize():i=np({eye_pos:yt,surf_norm:jt,mapN:r,uv:ms()})),i}}const ur=N(sp),rp=$(({textureNode:s,bumpScale:t})=>{const e=r=>s.cache().context({getUV:i=>r(i.uvNode||ms()),forceUVContext:!0}),n=Et(e(r=>r));return Te(Et(e(r=>r.add(r.dFdx()))).sub(n),Et(e(r=>r.add(r.dFdy()))).sub(n)).mul(t)}),ip=$(s=>{const{surf_pos:t,surf_norm:e,dHdxy:n}=s,r=t.dFdx().normalize(),i=t.dFdy().normalize(),o=e,a=i.cross(o),h=o.cross(r),u=r.dot(a).mul(gs),c=u.sign().mul(n.x.mul(a).add(n.y.mul(h)));return u.abs().mul(e).sub(c).normalize()});class op extends rt{static get type(){return"BumpMapNode"}constructor(t,e=null){super("vec3"),this.textureNode=t,this.scaleNode=e}setup(){const t=this.scaleNode!==null?this.scaleNode:1,e=rp({textureNode:this.textureNode,bumpScale:t});return ip({surf_pos:yt,surf_norm:jt,dHdxy:e})}}const ap=N(op),cr=new Map;class y extends b{static get type(){return"MaterialNode"}constructor(t){super(),this.scope=t}getCache(t,e){let n=cr.get(t);return n===void 0&&(n=Jd(t,e),cr.set(t,n)),n}getFloat(t){return this.getCache(t,"float")}getColor(t){return this.getCache(t,"color")}getTexture(t){return this.getCache(t==="map"?"map":t+"Map","texture")}setup(t){const e=t.context.material,n=this.scope;let r=null;if(n===y.COLOR){const i=e.color!==void 0?this.getColor(n):O();e.map&&e.map.isTexture===!0?r=i.mul(this.getTexture("map")):r=i}else if(n===y.OPACITY){const i=this.getFloat(n);e.alphaMap&&e.alphaMap.isTexture===!0?r=i.mul(this.getTexture("alpha")):r=i}else if(n===y.SPECULAR_STRENGTH)e.specularMap&&e.specularMap.isTexture===!0?r=this.getTexture("specular").r:r=Et(1);else if(n===y.SPECULAR_INTENSITY){const i=this.getFloat(n);e.specularIntensityMap&&e.specularIntensityMap.isTexture===!0?r=i.mul(this.getTexture(n).a):r=i}else if(n===y.SPECULAR_COLOR){const i=this.getColor(n);e.specularColorMap&&e.specularColorMap.isTexture===!0?r=i.mul(this.getTexture(n).rgb):r=i}else if(n===y.ROUGHNESS){const i=this.getFloat(n);e.roughnessMap&&e.roughnessMap.isTexture===!0?r=i.mul(this.getTexture(n).g):r=i}else if(n===y.METALNESS){const i=this.getFloat(n);e.metalnessMap&&e.metalnessMap.isTexture===!0?r=i.mul(this.getTexture(n).b):r=i}else if(n===y.EMISSIVE){const i=this.getFloat("emissiveIntensity"),o=this.getColor(n).mul(i);e.emissiveMap&&e.emissiveMap.isTexture===!0?r=o.mul(this.getTexture(n)):r=o}else if(n===y.NORMAL)e.normalMap?(r=ur(this.getTexture("normal"),this.getCache("normalScale","vec2")),r.normalMapType=e.normalMapType):e.bumpMap?r=ap(this.getTexture("bump").r,this.getFloat("bumpScale")):r=jt;else if(n===y.CLEARCOAT){const i=this.getFloat(n);e.clearcoatMap&&e.clearcoatMap.isTexture===!0?r=i.mul(this.getTexture(n).r):r=i}else if(n===y.CLEARCOAT_ROUGHNESS){const i=this.getFloat(n);e.clearcoatRoughnessMap&&e.clearcoatRoughnessMap.isTexture===!0?r=i.mul(this.getTexture(n).r):r=i}else if(n===y.CLEARCOAT_NORMAL)e.clearcoatNormalMap?r=ur(this.getTexture(n),this.getCache(n+"Scale","vec2")):r=jt;else if(n===y.SHEEN){const i=this.getColor("sheenColor").mul(this.getFloat("sheen"));e.sheenColorMap&&e.sheenColorMap.isTexture===!0?r=i.mul(this.getTexture("sheenColor").rgb):r=i}else if(n===y.SHEEN_ROUGHNESS){const i=this.getFloat(n);e.sheenRoughnessMap&&e.sheenRoughnessMap.isTexture===!0?r=i.mul(this.getTexture(n).a):r=i,r=r.clamp(.07,1)}else if(n===y.ANISOTROPY)if(e.anisotropyMap&&e.anisotropyMap.isTexture===!0){const i=this.getTexture(n);r=si(oe.x,oe.y,oe.y.negate(),oe.x).mul(i.rg.mul(2).sub(Te(1)).normalize().mul(i.b))}else r=oe;else if(n===y.IRIDESCENCE_THICKNESS){const i=nn("1","float",e.iridescenceThicknessRange);if(e.iridescenceThicknessMap){const o=nn("0","float",e.iridescenceThicknessRange);r=i.sub(o).mul(this.getTexture(n).g).add(o)}else r=i}else if(n===y.TRANSMISSION){const i=this.getFloat(n);e.transmissionMap?r=i.mul(this.getTexture(n).r):r=i}else if(n===y.THICKNESS){const i=this.getFloat(n);e.thicknessMap?r=i.mul(this.getTexture(n).g):r=i}else if(n===y.IOR)r=this.getFloat(n);else if(n===y.LIGHT_MAP)r=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===y.AO)r=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else{const i=this.getNodeType(t);r=this.getCache(n,i)}return r}}y.ALPHA_TEST="alphaTest";y.COLOR="color";y.OPACITY="opacity";y.SHININESS="shininess";y.SPECULAR="specular";y.SPECULAR_STRENGTH="specularStrength";y.SPECULAR_INTENSITY="specularIntensity";y.SPECULAR_COLOR="specularColor";y.REFLECTIVITY="reflectivity";y.ROUGHNESS="roughness";y.METALNESS="metalness";y.NORMAL="normal";y.CLEARCOAT="clearcoat";y.CLEARCOAT_ROUGHNESS="clearcoatRoughness";y.CLEARCOAT_NORMAL="clearcoatNormal";y.EMISSIVE="emissive";y.ROTATION="rotation";y.SHEEN="sheen";y.SHEEN_ROUGHNESS="sheenRoughness";y.ANISOTROPY="anisotropy";y.IRIDESCENCE="iridescence";y.IRIDESCENCE_IOR="iridescenceIOR";y.IRIDESCENCE_THICKNESS="iridescenceThickness";y.IOR="ior";y.TRANSMISSION="transmission";y.THICKNESS="thickness";y.ATTENUATION_DISTANCE="attenuationDistance";y.ATTENUATION_COLOR="attenuationColor";y.LINE_SCALE="scale";y.LINE_DASH_SIZE="dashSize";y.LINE_GAP_SIZE="gapSize";y.LINE_WIDTH="linewidth";y.LINE_DASH_OFFSET="dashOffset";y.POINT_WIDTH="pointWidth";y.DISPERSION="dispersion";y.LIGHT_MAP="light";y.AO="ao";y.ALPHA_TEST;y.COLOR;y.SHININESS;y.EMISSIVE;y.OPACITY;y.SPECULAR;y.SPECULAR_INTENSITY;y.SPECULAR_COLOR;y.SPECULAR_STRENGTH;y.REFLECTIVITY;y.ROUGHNESS;y.METALNESS;y.CLEARCOAT;y.CLEARCOAT_ROUGHNESS;y.ROTATION;y.SHEEN;y.SHEEN_ROUGHNESS;y.ANISOTROPY;y.IRIDESCENCE;y.IRIDESCENCE_IOR;y.IRIDESCENCE_THICKNESS;y.TRANSMISSION;y.THICKNESS;y.IOR;y.ATTENUATION_DISTANCE;y.ATTENUATION_COLOR;y.LINE_SCALE;y.LINE_DASH_SIZE;y.LINE_GAP_SIZE;y.LINE_WIDTH;y.LINE_DASH_OFFSET;y.POINT_WIDTH;y.DISPERSION;y.LIGHT_MAP;y.AO;const oe=st(new ot).onReference(function(s){return s.material}).onRenderUpdate(function({material:s}){this.value.set(s.anisotropy*Math.cos(s.anisotropyRotation),s.anisotropy*Math.sin(s.anisotropyRotation))}),ae=new dn,vn=new It;class nt extends b{static get type(){return"SceneNode"}constructor(t=nt.BACKGROUND_BLURRINESS,e=null){super(),this.scope=t,this.scene=e}setup(t){const e=this.scope,n=this.scene!==null?this.scene:t.scene;let r;return e===nt.BACKGROUND_BLURRINESS?r=nn("backgroundBlurriness","float",n):e===nt.BACKGROUND_INTENSITY?r=nn("backgroundIntensity","float",n):e===nt.BACKGROUND_ROTATION?r=st("mat4").label("backgroundRotation").setGroup(Me).onRenderUpdate(()=>{const i=n.background;return i!==null&&i.isTexture&&i.mapping!==ts?(ae.copy(n.backgroundRotation),ae.x*=-1,ae.y*=-1,ae.z*=-1,vn.makeRotationFromEuler(ae)):vn.identity(),vn}):console.error("THREE.SceneNode: Unknown scope:",e),r}}nt.BACKGROUND_BLURRINESS="backgroundBlurriness";nt.BACKGROUND_INTENSITY="backgroundIntensity";nt.BACKGROUND_ROTATION="backgroundRotation";nt.BACKGROUND_BLURRINESS;nt.BACKGROUND_INTENSITY;nt.BACKGROUND_ROTATION;$(({texture:s,uv:t})=>{const n=O().toVar();return Xc(t.x.lessThan(1e-4),()=>{n.assign(O(1,0,0))}).ElseIf(t.y.lessThan(1e-4),()=>{n.assign(O(0,1,0))}).ElseIf(t.z.lessThan(1e-4),()=>{n.assign(O(0,0,1))}).ElseIf(t.x.greaterThan(1-1e-4),()=>{n.assign(O(-1,0,0))}).ElseIf(t.y.greaterThan(1-1e-4),()=>{n.assign(O(0,-1,0))}).ElseIf(t.z.greaterThan(1-1e-4),()=>{n.assign(O(0,0,-1))}).Else(()=>{const i=s.sample(t.add(O(-.01,0,0))).r.sub(s.sample(t.add(O(.01,0,0))).r),o=s.sample(t.add(O(0,-.01,0))).r.sub(s.sample(t.add(O(0,.01,0))).r),a=s.sample(t.add(O(0,0,-.01))).r.sub(s.sample(t.add(O(0,0,.01))).r);n.assign(O(i,o,a))}),n.normalize()});const hp=new ot;class up extends fn{static get type(){return"PassTextureNode"}constructor(t,e){super(e),this.passNode=t,this.setUpdateMatrix(!1)}setup(t){return t.object.isQuadMesh&&this.passNode.build(t),super.setup(t)}clone(){return new this.constructor(this.passNode,this.value)}}class lr extends up{static get type(){return"PassMultipleTextureNode"}constructor(t,e,n=!1){super(t,null),this.textureName=e,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(t){return this.updateTexture(),super.setup(t)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class pn extends rt{static get type(){return"PassNode"}constructor(t,e,n,r={}){super("vec4"),this.scope=t,this.scene=e,this.camera=n,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;const i=new xs;i.isRenderTargetTexture=!0,i.name="depth";const o=new Fi(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:mc,...r});o.texture.name="output",o.depthTexture=i,this.renderTarget=o,this._textures={output:o.texture,depth:i},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=st(0),this._cameraFar=st(0),this._mrt=null,this.isPassNode=!0,this.updateBeforeType=G.FRAME}setMRT(t){return this._mrt=t,this}getMRT(){return this._mrt}isGlobal(){return!0}getTexture(t){let e=this._textures[t];return e===void 0&&(e=this.renderTarget.texture.clone(),e.name=t,this._textures[t]=e,this.renderTarget.textures.push(e)),e}getPreviousTexture(t){let e=this._previousTextures[t];return e===void 0&&(e=this.getTexture(t).clone(),this._previousTextures[t]=e),e}toggleTexture(t){const e=this._previousTextures[t];if(e!==void 0){const n=this._textures[t],r=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[r]=e,this._textures[t]=e,this._previousTextures[t]=n,this._textureNodes[t].updateTexture(),this._previousTextureNodes[t].updateTexture()}}getTextureNode(t="output"){let e=this._textureNodes[t];return e===void 0&&(e=T(new lr(this,t)),e.updateTexture(),this._textureNodes[t]=e),e}getPreviousTextureNode(t="output"){let e=this._previousTextureNodes[t];return e===void 0&&(this._textureNodes[t]===void 0&&this.getTextureNode(t),e=T(new lr(this,t,!0)),e.updateTexture(),this._previousTextureNodes[t]=e),e}getViewZNode(t="depth"){let e=this._viewZNodes[t];if(e===void 0){const n=this._cameraNear,r=this._cameraFar;this._viewZNodes[t]=e=vi(this.getTextureNode(t),n,r)}return e}getLinearDepthNode(t="depth"){let e=this._linearDepthNodes[t];if(e===void 0){const n=this._cameraNear,r=this._cameraFar,i=this.getViewZNode(t);this._linearDepthNodes[t]=e=Ve(i,n,r)}return e}setup({renderer:t}){return this.renderTarget.samples=this.options.samples===void 0?t.samples:this.options.samples,t.backend.isWebGLBackend===!0&&(this.renderTarget.samples=0),this.scope===pn.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(t){const{renderer:e}=t,{scene:n,camera:r}=this;this._pixelRatio=e.getPixelRatio();const i=e.getSize(hp);this.setSize(i.width,i.height);const o=e.getRenderTarget(),a=e.getMRT();this._cameraNear.value=r.near,this._cameraFar.value=r.far;for(const h in this._previousTextures)this.toggleTexture(h);e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),e.render(n,r),e.setRenderTarget(o),e.setMRT(a)}setSize(t,e){this._width=t,this._height=e;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget.setSize(n,r)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}pn.COLOR="color";pn.DEPTH="depth";O(1.6605,-.1246,-.0182),O(-.5876,1.1329,-.1006),O(-.0728,-.0083,1.1187);O(.6274,.0691,.0164),O(.3293,.9195,.088),O(.0433,.0113,.8956);function ki(s){let t;const e=s.context.getViewZ;return e!==void 0&&(t=e(this)),(t||yt.z).negate()}$(([s,t],e)=>{const n=ki(e);return mi(s,t,n)});$(([s],t)=>{const e=ki(t);return s.mul(s,e,e).negate().exp().oneMinus()});$(([s,t])=>vt(t.toFloat().mix(sr.rgb,s.toVec3()),sr.a));class cp extends b{constructor(t){super(),this.scope=t}generate(t){const{scope:e}=this,{renderer:n}=t;n.backend.isWebGLBackend===!0?t.addFlowCode(`	// ${e}Barrier 
`):t.addLineFlowCode(`${e}Barrier()`,this)}}N(cp);class Tt extends rt{static get type(){return"AtomicFunctionNode"}constructor(t,e,n,r=null){super("uint"),this.method=t,this.pointerNode=e,this.valueNode=n,this.storeNode=r}getInputType(t){return this.pointerNode.getNodeType(t)}getNodeType(t){return this.getInputType(t)}generate(t){const e=this.method,n=this.getNodeType(t),r=this.getInputType(t),i=this.pointerNode,o=this.valueNode,a=[];a.push(`&${i.build(t,r)}`),a.push(o.build(t,r));const h=`${t.getMethod(e,n)}( ${a.join(", ")} )`;if(this.storeNode!==null){const u=this.storeNode.build(t,r);t.addLineFlowCode(`${u} = ${h}`,this)}else t.addLineFlowCode(h,this)}}Tt.ATOMIC_LOAD="atomicLoad";Tt.ATOMIC_STORE="atomicStore";Tt.ATOMIC_ADD="atomicAdd";Tt.ATOMIC_SUB="atomicSub";Tt.ATOMIC_MAX="atomicMax";Tt.ATOMIC_MIN="atomicMin";Tt.ATOMIC_AND="atomicAnd";Tt.ATOMIC_OR="atomicOr";Tt.ATOMIC_XOR="atomicXor";N(Tt);const lp=$(s=>{const{lightDistance:t,cutoffDistance:e,decayExponent:n}=s,r=t.pow(n).max(.01).reciprocal();return e.greaterThan(0).select(r.mul(t.div(e).pow4().oneMinus().clamp().pow2()),r)});$(({color:s,lightViewPosition:t,cutoffDistance:e,decayExponent:n},r)=>{const i=r.context.lightingModel,o=t.sub(yt),a=o.normalize(),h=o.length(),u=lp({lightDistance:h,cutoffDistance:e,decayExponent:n}),c=s.mul(u),l=r.context.reflectedLight;i.direct({lightDirection:a,lightColor:c,reflectedLight:l},r.stack,r)});var fp=Xi('<canvas id="canvas" class="svelte-blob14"></canvas>');function Tp(s,t){Bi(t,!1);function e(M){M.style.width=window.innerWidth,M.style.height=window.innerHeight,M.width=window.innerWidth,M.height=window.innerHeight}let n=60,r,i,o=gn(0),a=gn(0);const h=M=>{r=M.clientX,i=M.clientY};let u=mn(t,"dark",8,!0),c=["#F45050","#9195F6","#ffffff"],l=["#CDC1FF","#ffffff"];const f=Ur(u()?c:l);let d,g,x=gn(),w,_=Math.random()*222,v=mn(t,"spd",8,5),E=mn(t,"scale",8,.0025);Pi(async()=>{g=await Hi(()=>import("./lHZLbDdf.js").then(M=>M.i),[],import.meta.url),d=new g.Noise(Math.random()),w=Dt(x).getContext("2d"),e(Dt(x)),C()});const F=(M,X,J,Y)=>d.perlin3(M*Y,X*Y,J*Y)*Math.PI,C=()=>{setTimeout(()=>requestAnimationFrame(C),1e3/n),w.clearRect(0,0,Dt(x).width,Dt(x).height);let M=15;for(let X=0;X<Dt(x).width+2;X+=M)for(let J=0;J<Dt(x).height;J+=M){let Y=F(X,J,_,E()),A=Math.sqrt(Math.pow(r-X,2)+Math.pow(i-J,2));A<=200&&(Y=Y*(A/200)),w.save(),w.beginPath(),w.translate(X,J);let Q=Math.abs(2*Y);w.arc(0,0,Q,0,Math.PI*2,!0),Y=Math.min(Math.abs(Y),1),w.fillStyle=f(Y),w.fill(),w.restore()}_+=v()};Yi();var k=fp();Ns("mousemove",Vi.body,h),Ns("resize",$i,e),qi(k,M=>yn(x,M),()=>Dt(x)),ws("innerWidth",M=>yn(o,M)),ws("innerHeight",M=>yn(a,M)),Gi(s,k),Ui()}export{Tp as B,Np as s};
